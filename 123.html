<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="format-detection" content="telephone=no, address=no, email=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta http-equiv="Cache-Control" content="no-cache"/>
<meta http-equiv="Expires" content="0"/>
<meta http-equiv="Pragma" content="no-cache"/>
<title>신세계백화점</title>
<link rel="stylesheet" type="text/css" href="http://vipm.shinsegae.com/vipmobile/resources/css/style.css">
<link rel="stylesheet" type="text/css" href="http://vipm.shinsegae.com/vipmobile/resources/css/popup.css">
<script type="text/javascript" src="http://vipm.shinsegae.com/vipmobile/resources/js/jquery-1.11.1.min.js"></script>
<script type="text/javascript" src="http://vipm.shinsegae.com/vipmobile/resources/js/jquery.bpopup.min.js"></script>
<script type="text/javascript" src="http://vipm.shinsegae.com/vipmobile/resources/js/jquery-barcode-2.0.2.min.js"></script>
<script type="text/javascript" src="http://vipm.shinsegae.com/vipmobile/resources/js/swiper.min.js"></script>
<script type="text/javascript" src="http://vipm.shinsegae.com/vipmobile/resources/js/fn_map.js"></script>
<script type="text/javascript" src="http://vipm.shinsegae.com/vipmobile/resources/js/fn_com.js?version=20160531"></script>
<script type="text/javascript">
var width = window.screen.width;
if (width == 320) {
 // document.write('<meta name="viewport" content="width=device-width,initial-scale=0.88,minimum-scale=0.88,maximum-scale=0.88,user-scalable=no">');
 document.write('<meta id="viewport" name="viewport" content="width=device-width,initial-scale=0.88,minimum-scale=0.88,maximum-scale=4.0,user-scalable=yes">');
} else {
 // document.write('<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">');
 document.write('<meta id="viewport" name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=4.0,user-scalable=yes">');
}
</script>
<script type="text/javascript">
$(document).ready(function(){
	//세대원일 경우 세대원 신청 여부 확인 후 신청 버튼 HIDE
	if("N" == "N" && "" != ""){
		//alert("세대원이냐고?");
		$("span").each(function(){
			if($(this).text() == "신청"){
				$(this).hide();
			}
		});
	}

	// [첫번째 STEP] 품목그룹 선택창 버튼 이벤트 활성화
	$('#req_cancel').click(function() {
		hideStep1();
	});
	$('#req_confirm').click(function() {
		//alert("#req_confirm click event");
		step1Confirm();
	});
});

var rtnConfirmPopVal 		= false;	// 리턴 구분값(메시지 선택 팝업)
var rtnReqVal				= false;	// 리턴 구분값(신청 팝업)
var rtnChkUpd				= false;	// 리턴 구분값(신청, 수정)
var rtn_togatman_psn_cnt 	= '';		// 리턴 동반자 인원
var rtn_itm_grp_seq 		= '';		// 리턴 품목 그룹 순번
var rtn_itm_Seq 			= '';		// 리턴 품목 순번
var rtn_hope_Seq 			= '';		// 리턴 희망 순번
var rtn_deli_catg_cd 		= '';		// 리턴 배송 분류 코드
var rtn_hope_recv_recv_dt	= '';		// 리턴 희망 수령 접수 일자
var rtn_recv_cust_nm 		= '';		// 리턴 수령 고객 명
var rtn_recv_tel 			= '';		// 리턴 수령 전화
var rtn_recv_tel2 			= '';		// 리턴 수령 전화2
var rtn_post_no 			= '';		// 리턴 우편 번호
var rtn_recv_addr1 			= '';		// 리턴 수령 주소1
var rtn_recv_addr2 			= '';		// 리턴 수령 주소2
var rtn_prvtinf_arge_yn		= '';		// 리턴 개인정보 동의 여부
var rtn_deli_bigo			= '';		// 리턴 배송 비고
var rtn_duct_prvt_pt		= 0;		// 리턴 차감 프라이빗 포인트
var rtn_etcInfo				= '';		// 리턴 기타 정보
var rtn_old_pasg_id			= '';		// 리턴 기존 인원 정보
var rtn_cur_pasg_id			= '';		// 리턴 변경 인원 정보
var rtn_deli_catg_cd_valid 	= "true";	// 리턴 배송 분류 코드 구분(품목그룹안의 품목들의 배송분류코드가 모두 같으면 true 하나라도 다르면 false) 
var rtn_hope_tm				= "";		// 리턴 희망일의 시간
var rtnHopeDtNone			= false;
var rtn_store_cd			= "";		// 리턴 수령점포
var hopeDtUseCd				= '';		// 희망일구분
var idx = '';

//바코드 settings
var settings = {
		output : 'css',
		bgColor : '#FFFFFF',
		color : '#333333',
		barWidth : '2',
		barHeight : '55px',
		moduleSize : '5',
		posX : '110',
		posY : '120',
		addQuietZone : '1',
		fontSize : 12
};

function hideStep1() {
	// 뷰포트 초기화 - 확대 가능 (171026 수정)
	var width = window.screen.width;
	if (width == 320){
		document.getElementById('viewport').setAttribute('content','width=device-width,initial-scale=0.88,minimum-scale=0.88,maximum-scale=4.0,user-scalable=yes');
	}else{
		document.getElementById('viewport').setAttribute('content','width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=4.0,user-scalable=yes');
	}

	setVisiblity('dim', false);
	setVisiblity('step1ReqPop', false);
}

function setVisiblity(id, show) {
	if (show == true) {
		$('#' + id).show();
	} else {
		$('#' + id).hide();
	}
}

// 좌석 정보 조회
function getEmptySeats(){
	var param = $('form[name="frmEventDetail"]').serialize();
	$.ajax({
		type: 'POST',
   		url: 'http://vipm.shinsegae.com/vipmobile/event/getEmptySeats.do',
   		data: param,
  	  	dataType: 'json',
  	  	async : true,	// true:비동기, false:동기
  	  	cache : false,
	  	timeout : 30000,
  	  	success : function(data) {

  	  		var arrList = data.list;
  	  		var msg = '';
  	  		
  	  		if(arrList.length == 1){
  	  			msg = '신청 가능한 잔여 좌석 <span>' + arrList[0].EMPTY_SEATS + '석</span>';
  	  		}else if(arrList.length > 1){
  	  			msg += '신청 가능한 잔여 좌석<br>';
  	  			$.each(arrList, function(index, item) {
  	  				var hope_dt = fn_chkNull(item.HOPE_DT);
  	  				var empty_seats = fn_chkNull(item.EMPTY_SEATS);
  	  				
  	  				if((index+1) != arrList.length){
  	  					msg += '<span>' + hope_dt + ' : ' + empty_seats + '석</span><br>'; 
  	  				}else{
  	  					msg += '<span>' + hope_dt + ' : ' + empty_seats + '석</span>'; 
  	  				}
  	  			});
  	  		}
  	  		
  	  		fn_messagePop('<p>' + msg + '</p>');
		}
	});
}

// 좌석 정보 체크
function chkEmptySeats(selected_psn_cnt, rsrv_togat_psn_cnt){
	var chk = true;
	var msg = '';
	
	var param = $('form[name="frmEventDetail"]').serialize();
	$.ajax({
		type: 'POST',
   		url: 'http://vipm.shinsegae.com/vipmobile/event/getEmptySeats.do',
   		data: param,
  	  	dataType: 'json',
  	  	async : true,	// true:비동기, false:동기
  	  	cache : false,
	  	timeout : 30000,
  	  	success : function(data) {
  	  		var arrList = data.list;
  	  		var possible_cnt = arrList[0].EMPTY_SEATS;
  	  		
//   	  		alert("가능인원:"+possible_cnt);
//   	  		alert("예약인원:"+rsrv_togat_psn_cnt);
//   	  		alert("수정한인원:"+selected_psn_cnt);
  	  		
	  	  	// 신청
	  	   	if($('form[name="frmEventDetail"] input[name="req_cnt"]').val() <= 0){
	  	   		if(possible_cnt < selected_psn_cnt){
		  	  		chk = false;
		  	  		msg = '신청 가능한 잔여 좌석 <span>' + possible_cnt + '석<span>';
	  	  		}  	  
	  	   		
	  	   	// 수정
	  	   	}else if($('form[name="frmEventDetail"] input[name="req_cnt"]').val() > 0){
	  	   		possible_cnt = possible_cnt + rsrv_togat_psn_cnt;
	  	   		if(possible_cnt < selected_psn_cnt){
		  	  		chk = false;
		  	  		msg = '신청 가능한 잔여 좌석 <span>' + possible_cnt + '석<span>';
	  	   		}
	  	   	}
		}
	});
	
	if(!chk){
		fn_messagePop(msg);
		return false;
		
	}else{
		return true;
	}
}

// NEXT CONTENTS로 이동
function nextEventDetail(){
	var specialsYn = $('#N_SPEICAL_YN').val();
	var nextCd = $('#N_BENE_CD').val();
	var nextCreatSeq = $('#N_BENE_CREAT_SEQ').val();
	
	if(nextCd == '' && nextCreatSeq == ''){
		fn_messagePop('<p>마지막 입니다.</p>');
		return false;
	}
	
	if (specialsYn == 'Y') {
		$('form[name="frmEventDetail"] input[name="THESPECIAL_CREAT_SEQ"]').val(nextCreatSeq);
		$('form[name="frmEventDetail"]').attr('action', 'http://vipm.shinsegae.com/vipmobile/specials/detail.do').attr('method', 'post').submit();
	} else {
		var upperCatgCd = $('#N_UPPER_CATG_CD').val();
		$('form[name="frmEventDetail"] input[name="upper_catg_cd"]').val(upperCatgCd);
		$('form[name="frmEventDetail"] input[name="bene_cd"]').val(nextCd);
		$('form[name="frmEventDetail"] input[name="bene_creat_seq"]').val(nextCreatSeq);
		$('form[name="frmEventDetail"]').attr('action', 'http://vipm.shinsegae.com/vipmobile/event/eventDetail.do').attr('method', 'post').submit();	
	}
}

function fnCallRefresh() {
//	location.href = 'toApp:refresh';
	location.href = 'toApp:vippointrefresh';
}

//품목그룹안의 품목의 희망일 체크(품목들이 모두 희망일 지정일경우 && 희망일시가 모두 같아야함)
function isHopeDtValid(bene_cd, bene_creat_seq, itm_grp_seq){
	var param = {};
	param.bene_cd = bene_cd;
	param.bene_creat_seq = bene_creat_seq;
	param.itm_grp_seq = itm_grp_seq;
	var rtnVal = '';
	
	$.ajax({
		type: 'POST',
   		url: 'http://vipm.shinsegae.com/vipmobile/event/isHopeDtValid.do',
   		data: param,
  	  	dataType: 'json',
  	  	async : false,	// true:비동기, false:동기
  	  	cache : false,
	  	timeout : 30000,
  	  	success : function(data) {
			rtnVal = data.validGb;
			hopeDtUseCd = data.hopeDtUseCd;
  	  	}
	});
	
	return rtnVal;
}

/*해당이벤트 즉시사용가능 체크*/
function isNoReqUse(bene_cd, bene_creat_seq){
	var param = {};
	param.bene_cd = bene_cd;
	param.bene_creat_seq = bene_creat_seq;
	var rtnVal = '';
	
	$.ajax({
		type: 'POST',
   		url: 'http://vipm.shinsegae.com/vipmobile/event/isNoReqUse.do',
   		data: param,
  	  	dataType: 'json',
  	  	async : false,	// true:비동기, false:동기
  	  	cache : false,
	  	timeout : 30000,
  	  	success : function(data) {
			rtnVal = data.USE_GUBUN_CD;
  	  	}
	});
	
	return rtnVal;
}


/*********************************************************************이벤트 신청 프로세스 변경 START*************************************************************************/
// 이벤트 신청 팝업
function reqEventPopNew(chkUpd, id){
	// 뷰포트 초기화 - 확대 불가 (171026 수정)
	var width = window.screen.width;
	if (width == 320){
		document.getElementById('viewport').setAttribute('content','width=device-width,initial-scale=0.88,minimum-scale=0.88,maximum-scale=0.88,user-scalable=no');
	}else{
		document.getElementById('viewport').setAttribute('content','width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no');
	}

	rtnChkUpd = chkUpd;
	if (rtnChkUpd == true) {
		idx = id;
	} else {
		idx = '';
	}

	rtnReqVal = false;							// 초기화
	rtnHopeDtNone = true;
	step1GetPassenger();						// 인원 selectbox 셋팅
	step1SetModValues();						// 수정 시 값 셋팅
	step1SetRemainCntPt();						// 남은 신청 회수, 포인트
	
	setVisiblity('dim', true);
	setVisiblity('step1ReqPop', true);

	// 여기부터 초기화 다시
	// 셀렉트 박스 레이어 드롭다운, 토글 클래스
	var toggleClick = function(){
		if(clicked == true) { 
			return false;
		}
		
		clicked = true;
		var divObj = $(this).next();
		var nstyle = divObj.css('display');
		if(nstyle == 'none'){
			$('.op_lst').slideUp('fast');
			$('.op_lb').removeClass('open');
			divObj.slideDown('fast');
			$(this).addClass('open');
		}else{
			divObj.slideUp('fast');
			$(this).removeClass('open');
		}

		setTimeout ('fnClickInit()', delay);
	};
	$('.op_lb').bind('touchstart click',toggleClick);
	$(document).bind('touchstart click',function(e){
		if(!$(e.target).is('.op_lb, .op_lst li')){			
			$('.op_lb').next().slideUp('fast').prev().removeClass('open');
			$('html').unbind('click');
		} else {
			e.preventDefault();
		}
	});
	
	// op_lst li 클릭 시 "selected"클래스 추가
	$('.op_lst li').bind('touchstart click',function(e){
		e.preventDefault();		
		
		$(this).addClass('selected').siblings().removeClass('selected');
		$('.op_lb').next().slideUp('fast').prev().removeClass('open');
		
		step1DropDownSelected($(this));		
	});	

}

//인원 조회
function step1GetPassenger(){
	var togatman_psn_cnt = $('form[name=frmEventDetail] input[name=togatman_psn_cnt]').val();
	if(togatman_psn_cnt < 1){	/*동반인원 없음일때 selectbox삭제*/
		$('.cdt_bx .cdt').eq(1).remove();
	}else{
		$('#divPassenger ul li').remove();	// 초기화
		
		for(var i = togatman_psn_cnt; i >= 1; i--){
			$('#divPassenger ul').append('<li><input type="radio" name="raPassenger" value="'+i+'" id="pasg'+i+'"><label>회원 본인과 동반 '+i+'인</label></li>');
		}
		$('#divPassenger ul').append('<li><input type="radio" name="raPassenger" value="0" id="pasg'+i+'"><label>회원 본인</label></li>');
	}
}

//수정 시 값 셋팅
function step1SetModValues(){
	if(rtnChkUpd){
		// 품목 그룹 순번(코스)
		$('input:radio[name="raItemGroup"]:radio[value="'+$('form[name="frmEventNoti'+idx+'"] input[name="itm_grp_seq"]').val()+'"]').attr('checked', true);
		$('#selItemGroup').html($('form[name="frmEventNoti'+idx+'"] input[name="itm_grp_nm"]').val());
		step1GetItem($('form[name="frmEventNoti'+idx+'"] input[name="itm_grp_seq"]').val());
		
		// 인원
		$('input:radio[name="raPassenger"]:radio[value="'+$('form[name="frmEventNoti'+idx+'"] input[name="rsrv_togat_psn_cnt"]').val()+'"]').attr('checked', true);
		var txtPassenger = '';
		var rsrv_togat_psn_cnt = $('form[name="frmEventNoti'+idx+'"] input[name="rsrv_togat_psn_cnt"]').val();
		if(rsrv_togat_psn_cnt > 0){
			txtPassenger = '회원 본인과 동반 '+rsrv_togat_psn_cnt+'인';
		}else{
			txtPassenger = '회원 본인';
		}
		$('#selPassenger').text(txtPassenger);
		$('#rsrv_togat_psn_cnt').val(rsrv_togat_psn_cnt);
		
		/*수정일때 기존 인원값 id 저장*/
		rtn_old_pasg_id = $('input:radio[name="raPassenger"]:radio[value="'+$('form[name="frmEventNoti'+idx+'"] input[name="rsrv_togat_psn_cnt"]').val()+'"]').attr('id');
	}
}

//남은 신청 회수, 포인트
function step1SetRemainCntPt(){
	var txt_remain_cnt_pt = '';
	
	if('1' == $('form[name="frmEventDetail"] input[name="use_gubun_cd"]').val()){
		txt_remain_cnt_pt = '남은 신청 회수 : '+$('form[name="frmEventDetail"] input[name="remain_cnt_pt"]').val()+'회';
	}else if('2' == $('form[name="frmEventDetail"] input[name="use_gubun_cd"]').val()){
		var restPoint = $('form[name="frmEventDetail"] input[name="remain_cnt_pt"]').val();
		if (restPoint > 10000) {
			restPoint = parseInt((restPoint / 10000)) + '만';
		}
		txt_remain_cnt_pt = '남은 포인트 : '+restPoint+' 포인트';
	}
	/*
	else{
		txt_remain_cnt_pt = '제한없음';
	}
	*/
	
	$('#txt_remain_cnt_pt').text(txt_remain_cnt_pt);
}

/*********************************************************************이벤트 신청 프로세스 변경 END*************************************************************************/



















// 이벤트 신청
function insEvent(){
	var now_req_cnt = 0;
	var now_togat_ics_req_psn_cnt = 0;
	var pt_duct_except_yn = '';
	var duct_prvt_pt = 0;
	var rest_prvt_pt = 0;
	var use_prvt_pt = 0;

	now_req_cnt = 1;
	now_togat_ics_req_psn_cnt = 1 + Number(rtn_togatman_psn_cnt);

	// 포인트
	/* 20160719 kjk
	if("2" == $('form[name="frmEventDetail"] input[name="use_gubun_cd"]').val()){
		pt_duct_except_yn = 'N';
		duct_prvt_pt = rtn_duct_prvt_pt;
		rest_prvt_pt = -rtn_duct_prvt_pt;
		use_prvt_pt = rtn_duct_prvt_pt;
		
	// 횟수, 제한없음
	}else{
		pt_duct_except_yn = 'Y';
		duct_prvt_pt = 0;
	}
	*/
		
	pt_duct_except_yn = 'N';
	duct_prvt_pt = rtn_duct_prvt_pt;
	rest_prvt_pt = -rtn_duct_prvt_pt;
	use_prvt_pt = rtn_duct_prvt_pt;	
			
	// 예약일자, 시간	
	if('' == rtn_togatman_psn_cnt){
		rsrv_dt = '';
		rsrv_tm = '';
	}else{
		rsrv_dt = $('form[name="frmEventDetail"] input[name="exec_strt_dt"]').val();
		rsrv_tm = $('form[name="frmEventDetail"] input[name="exec_strt_tm"]').val();
	}
	
	$('form[name="frmEventDetail"] input[name="itm_grp_seq"]').val(rtn_itm_grp_seq);							// 품목 그룹 순번
 	$('form[name="frmEventDetail"] input[name="itm_seq"]').val(rtn_itm_Seq);									// 품목 순번
 	$('form[name="frmEventDetail"] input[name="hope_seq"]').val(rtn_hope_Seq);									// 희망 순번
 	$('form[name="frmEventDetail"] input[name="pt_duct_except_yn"]').val(pt_duct_except_yn);					// 포인트 차감 제외 여부
 	$('form[name="frmEventDetail"] input[name="duct_prvt_pt"]').val(duct_prvt_pt);								// 차감 프라이빗 포인트
 	$('form[name="frmEventDetail"] input[name="rest_prvt_pt"]').val(rest_prvt_pt);								// 차감 프라이빗 포인트(잔여 포인트 계산용)
 	$('form[name="frmEventDetail"] input[name="use_prvt_pt"]').val(use_prvt_pt);								// 차감 프라이빗 포인트(이력 포인트 계산용)
 	$('form[name="frmEventDetail"] input[name="now_req_cnt"]').val(now_req_cnt);								// 현재 신청 수
 	$('form[name="frmEventDetail"] input[name="now_togat_ics_req_psn_cnt"]').val(now_togat_ics_req_psn_cnt);	// 현재 동반 포함 신청 인원
 	$('form[name="frmEventDetail"] input[name="rsrv_togat_psn_cnt"]').val(rtn_togatman_psn_cnt);				// 예약 동반 인원
 	
 	/*아트&컬쳐의 혜택유형의 속성이 '문화이벤트'일 경우 사용자가 선택한 희망일을 예약일에 넣어주고 희망수령일은 빈값으로 저장*/
 	if($('form[name="frmEventDetail"] input[name="upper_catg_cd"]').val() == '1' && $('form[name="frmEventDetail"] input[name="bene_gubun_cd"]').val() == '01'){
 		$('form[name="frmEventDetail"] input[name="rsrv_dt"]').val(rtn_hope_recv_recv_dt);							// 예약일자 
 	 	$('form[name="frmEventDetail"] input[name="rsrv_tm"]').val(rtn_hope_tm);									// 예약시간
 	 	$('form[name="frmEventDetail"] input[name="hope_recv_recv_dt"]').val('');									// 희망 수령 접수 일자	
 	}else{
 		$('form[name="frmEventDetail"] input[name="rsrv_dt"]').val('');										// 예약일자 
 	 	$('form[name="frmEventDetail"] input[name="rsrv_tm"]').val('');										// 예약시간
 	 	$('form[name="frmEventDetail"] input[name="hope_recv_recv_dt"]').val(rtn_hope_recv_recv_dt);				// 희망 수령 접수 일자	
 	}
 	
 	$('form[name="frmEventDetail"] input[name="recv_cust_nm"]').val(rtn_recv_cust_nm);							// 수령 고객명
 	$('form[name="frmEventDetail"] input[name="recv_tel"]').val(rtn_recv_tel);									// 수령 전화
 	$('form[name="frmEventDetail"] input[name="recv_tel2"]').val(rtn_recv_tel2);								// 수령 전화2
 	$('form[name="frmEventDetail"] input[name="post_no"]').val(rtn_post_no);									// 우편 번호
 	$('form[name="frmEventDetail"] input[name="recv_addr1"]').val(rtn_recv_addr1);								// 수령 주소1
 	$('form[name="frmEventDetail"] input[name="recv_addr2"]').val(rtn_recv_addr2);								// 수령 주소2
 	$('form[name="frmEventDetail"] input[name="prvtinf_arge_yn"]').val(rtn_prvtinf_arge_yn);					// 개인정보 동의 여부
 	$('form[name="frmEventDetail"] input[name="deli_bigo"]').val(rtn_deli_bigo);								// 배송 비고
 	$('form[name="frmEventDetail"] input[name="etcInfo"]').val(rtn_etcInfo);									// 기타 정보
 	$('form[name="frmEventDetail"] input[name="recv_store_cd"]').val(rtn_store_cd);								// 수령 지점
 	
 	var param = $('form[name=frmEventDetail]').serialize();
	$.ajax({
		type: 'POST',
   		url: 'http://vipm.shinsegae.com/vipmobile/event/insEvent.do',
   		data: param,
  	  	dataType: 'json',
  	  	async : true,	// true:비동기, false:동기
  	  	cache : false,
	  	timeout : 30000,
  	  	success : function(data) {
  	  		if(data.MSG_CODE == "SUCCESS"){
	  	  		/*
	  	  		if (data.STS == '1') {
		  	  		if (data.RSN == '1') {
		  	  			fn_messagePop('<p>이미 신청하신 이벤트입니다.</p>', cbRefresh);
		  	  			return;	
		  	  		} else if (data.RSN == '2') {
			  	  		fn_messagePop('<p>잔여 좌석이 없습니다.</p>', cbRefresh);
		  	  			return;
		  	  		} else if (data.RSN == '3') {
			  	  		fn_messagePop('<p>선택하신 품목은 품절되었습니다.</p>', cbRefresh);
		  	  			return;
		  	  		} else if (data.RSN == '10') {
			  	  		fn_messagePop('<p>이벤트가 종료되었습니다.</p>', fnGoList);
		  	  			return;
		  	  		}
		  	  		
		  	  		return;
	  	  		}	
	  	  		*/
	  	  		
	  	  		if(data.cnt > 0){
					// 이벤트 신청완료 페이지이동
					$('form[name="frmEventDetail"] input[name="chkUpd"]').val(rtnChkUpd);
					$('form[name="frmEventDetail"] input[name="req_no"]').val(data.req_no);
	  	  			$('form[name="frmEventDetail"]').attr('action', 'http://vipm.shinsegae.com/vipmobile/event/eventComplete.do').attr('method', 'post').submit();
	  	  		}
	  	  	}
			else if(data.MSG_CODE.startsWith("EXISTS_BENE_REQ"))
			{
				fn_messagePop('<p>이미 신청하신 이벤트입니다.</p>', cbRefresh);
				return;				
			}	
			else if(data.MSG_CODE.startsWith("HOPE_DT_EXEC_DT_ERROR"))
			{
				fn_messagePop('<p>일자가 잘못되었습니다.<br>사용기간내에서 입력해 주세요.</p>', cbRefresh);
				return;
			}	
			else if(data.MSG_CODE.startsWith("DT_CHECK_ERROR"))
			{
				fn_messagePop('<p>신청이 불가능한 일자 입니다.</p>', cbRefresh);
				return;
			}
			else if(data.MSG_CODE.startsWith("GIFT_MODI_CHK_FAIL"))
			{
				fn_messagePop('<p>희망일은 현재일 기준 3일이후 일자만 신청이 가능합니다.</p>', cbRefresh);
				return;
			}		  	  	
	  	  	else {
	  	  		fn_AlertMsg(data);
	  	  		return;
	  	  	}
		}
	});
}

// 바코드 팝업
function barcodePop(idx){
	var req_limit_gubun_cd = $('form[name="frmEventDetail"] input[name="req_limit_gubun_cd"]').val();
	$('form[name="frmEventNoti'+idx+'"] input[name="limit_gubun_cd"]').val(req_limit_gubun_cd);
	$('form[name="frmEventNoti'+idx+'"]').attr('action', 'http://vipm.shinsegae.com/vipmobile/event/eventBarcodePop.do').attr('method', 'post').submit();
	/*
	var $layer_popup1 = $('<div class="layer_popup1"><div class="layer_bx1"></div></div>');//전체 화면 팝업
	var styles1 = {width : "100%", height : "100%"};//iframe 사이즈 정의
	var $layer_close = $('<a href="#" class=btn_close title="닫기"></a>');
	var $layer_close1 = $('<a href="#" class=btn_close1 title="닫기"></a>');//160617 추가
	$("body").append($layer_popup1);
	$layer_popup1.append($layer_close1);
	//e.preventDefault();
	$(".layer_popup1").css(styles1);
	$(".layer_popup1").bPopup({
		contentContainer:".layer_bx1",
		content:"iframe",
		loadUrl:'http://vipm.shinsegae.com/vipmobile/event/eventBarcodePop.do' +
		'?bene_cd='+$('form[name="frmEventNoti'+idx+'"] input[name="bene_cd"]').val() +					// 혜택 코드
		'&bene_creat_seq='+$('form[name="frmEventNoti'+idx+'"] input[name="bene_creat_seq"]').val() +	// 혜택 생성 순번
		'&req_no='+$('form[name="frmEventNoti'+idx+'"] input[name="req_no"]').val(),					// 신청 번호
		closeClass:"btn_close1",
		onClose: function(){
			$("body").unbind("touchmove");//touch event제거
		}
	});
	*/
	/*
	$("body").bind("touchmove", function(e){e.preventDefault()});
	$("#b-iframe").load(function () {//iframe이 모두 load된후 제어
		$(this).contents().find("body").bind("touchmove", function(e){e.preventDefault()});
	});
	*/
}

function fn_ImsiMsg(){
	//0825 현업요청으로 임시로 막음
	fn_messagePop('<p>컨시어지나 콜센터로 취소 변경 문의 바랍니다.</p>');
	return;
}

// 이벤트 신청 취소
function cancelReqEvent(idx){
	$('form[name="frmEventNoti'+idx+'"] input[name="now_req_cnt"]').val(-1);																										// 현재 신청 수
 	$('form[name="frmEventNoti'+idx+'"] input[name="now_togat_ics_req_psn_cnt"]').val(-1 + -Number($('form[name="frmEventNoti'+idx+'"] input[name="rsrv_togat_psn_cnt"]').val()));	// 현재 동반 포함 신청 인원
 	$('form[name="frmEventNoti'+idx+'"] input[name="rest_prvt_pt"]').val($('form[name="frmEventNoti'+idx+'"] input[name="duct_prvt_pt"]').val());									// 차감 프라이빗 포인트(잔여 포인트 계산용)
 	$('form[name="frmEventNoti'+idx+'"] input[name="use_prvt_pt"]').val(-$('form[name="frmEventNoti'+idx+'"] input[name="duct_prvt_pt"]').val());									// 차감 프라이빗 포인트(잔여 포인트 계산용)
 	 	
 	var param = $('form[name="frmEventNoti'+idx+'"]').serialize();
	$.ajax({
		type: 'POST',
   		url: 'http://vipm.shinsegae.com/vipmobile/event/delEvent.do',
   		data: param,
  	  	dataType: 'json',
  	  	async : true,	// true:비동기, false:동기
  	  	cache : false,
	  	timeout : 30000,
  	  	success : function(data) {
  	  		if(data.MSG_CODE == "SUCCESS"){
	  	  		if(data.cnt > 0){
	  	  			fnCallRefresh();
	  	  			fn_messagePop('<p>취소되었습니다.</p>', cbGoMainList);
	  	  		} else {
	  	  			fn_messagePop('<p>이미 취소된 이벤트입니다.</p>', cbRefresh);
	  	  		}	  	  		
	  	  	}
			else if(data.MSG_CODE.startsWith("LAST_USE_STS_CHG"))
			{
				fn_messagePop('<p>신청 상태 이벤트만 취소가 가능합니다.</p>', cbRefresh);
			}	
			else if(data.MSG_CODE.startsWith("RSRV_CHECK_FAIL"))
			{
				fn_messagePop('<p>예약하신 날짜가 지나 취소할 수 없습니다.</p>', cbRefresh);
			}	
			else if(data.MSG_CODE.startsWith("GIFT_MODI_CHK_FAIL"))
			{
				fn_messagePop('<p>희망일 3일전 또는 배송확정전 까지만 취소가 가능합니다.</p>', cbRefresh);
			}
			else if(data.MSG_CODE.startsWith("GIFT_MODI_CHK2_FAIL"))
			{
				fn_messagePop('<p>실물 배송 이벤트의 경우 신청 당일에만 취소가 가능합니다.</p>', cbRefresh);
			}	
			else if(data.MSG_CODE.startsWith("LAST_USE_STS_CANCEL"))
			{
				fn_messagePop('<p>이미 취소된 이벤트입니다.</p>', cbRefresh);
			}	
	  	  	else {
	  	  		fn_AlertMsg(data);
	  	  		return;
	  	  	}
		}
	});
}

//신청 취소 확인 후 이벤트 메인으로
function cbGoMainList(){
	var evtRoot = $("#EVT_ROOT").val();
	if (evtRoot == 'HISTORY') {
		fn_urlRedirect('http://vipm.shinsegae.com/vipmobile/history/historyEvent.do?upper_catg_cd=' + $("#upper_catg_cd").val());
	} else if (evtRoot == 'SPECIALS') {
		fn_urlRedirect('http://vipm.shinsegae.com/vipmobile/specials/main.do?CATG_CD=' + $("#THESPECIAL_CATG_CD").val());
	} else {
		fn_urlRedirect('http://vipm.shinsegae.com/vipmobile/event/main.do');	
	}
}

// 신청 취소 확인 후 callback
function cbRefresh(){
	//location.href = 'toApp:CLOSE';
	fnGoList();
}

// 품목 순번 변환
function setItemSeqChg(frmNm, itm_seq){
	var itemArr = new Array();
	var itemInfo = new Object();

 	for(var i=0; i<itm_seq.split('/').length; i++){
 		var tempInfo = new Object();
		tempInfo['itm_seq'] = itm_seq.split('/')[i].toString();
		itemArr.push(tempInfo);
 	}
 	
 	itemInfo.itemInfo = itemArr;
	var itm_seq = JSON.stringify(itemInfo);

	return itm_seq;
}

// 이벤트 수정
function updEvent(idx){
	var now_req_cnt = 0;
	var now_req_cnt_old = 0;
	var now_togat_ics_req_psn_cnt = 0;
	var now_togat_ics_req_psn_cnt_old = 0;
	var pt_duct_except_yn = '';
	var duct_prvt_pt = 0;
	var rest_prvt_pt = 0;
	var rest_prvt_pt_old = 0;
	var use_prvt_pt = 0;
	var use_prvt_pt_old = 0;
	var rsrv_dt = '';
	var rsrv_tm = '';
	
	if($('form[name="frmEventNoti'+idx+'"] input[name="itm_grp_seq"]').val() != rtn_itm_grp_seq){ // 품목 그룹이 변경된 경우
 		now_req_cnt = 1;
 		now_req_cnt_old = -1;
 		now_togat_ics_req_psn_cnt = 1 + Number(rtn_togatman_psn_cnt);
 		now_togat_ics_req_psn_cnt_old = -1 + -Number($('form[name="frmEventNoti'+idx+'"] input[name="rsrv_togat_psn_cnt"]').val());
	}else{
 		now_req_cnt = 0;
 		now_togat_ics_req_psn_cnt = -($('form[name="frmEventNoti'+idx+'"] input[name="rsrv_togat_psn_cnt"]').val() - rtn_togatman_psn_cnt);
	}

	// 포인트
	/* 20160719 kjk
	if("2" == $('form[name="frmEventNoti'+idx+'"] input[name="use_gubun_cd"]').val()){
		pt_duct_except_yn = 'N';
		duct_prvt_pt = rtn_duct_prvt_pt;
		
		if($('form[name="frmEventNoti'+idx+'"] input[name="itm_grp_seq"]').val() != rtn_itm_grp_seq){ // 품목 그룹이 변경된 경우
			rest_prvt_pt = -rtn_duct_prvt_pt;
			rest_prvt_pt_old = $('form[name="frmEventNoti'+idx+'"] input[name="duct_prvt_pt"]').val();
			use_prvt_pt = rtn_duct_prvt_pt;
			use_prvt_pt_old = -$('form[name="frmEventNoti'+idx+'"] input[name="duct_prvt_pt"]').val();
 		}else{
			duct_prvt_pt = 0;
 		}
		
	// 횟수, 제한없음
	}else{
		pt_duct_except_yn = 'Y';
		duct_prvt_pt = 0;
	}
	*/
	
	pt_duct_except_yn = 'N';
	duct_prvt_pt = rtn_duct_prvt_pt;
		
	if($('form[name="frmEventNoti'+idx+'"] input[name="itm_grp_seq"]').val() != rtn_itm_grp_seq){ // 품목 그룹이 변경된 경우
		rest_prvt_pt = -rtn_duct_prvt_pt;
		rest_prvt_pt_old = $('form[name="frmEventNoti'+idx+'"] input[name="duct_prvt_pt"]').val();
		use_prvt_pt = rtn_duct_prvt_pt;
		use_prvt_pt_old = -$('form[name="frmEventNoti'+idx+'"] input[name="duct_prvt_pt"]').val();
	}else{
		duct_prvt_pt = 0;
	}
				
	// 예약일자, 시간	
	if('' == rtn_togatman_psn_cnt){
		rsrv_dt = '';
		rsrv_tm = '';
	}else{
		rsrv_dt = $('form[name="frmEventDetail"] input[name="exec_strt_dt"]').val();
		rsrv_tm = $('form[name="frmEventDetail"] input[name="exec_strt_tm"]').val();
	}

 	$('form[name="frmEventNoti'+idx+'"] input[name="itm_grp_seq_old"]').val($('form[name="frmEventNoti'+idx+'"] input[name="itm_grp_seq"]').val());								// 품목 그룹 순번(old)
 	$('form[name="frmEventNoti'+idx+'"] input[name="itm_seq_old"]').val(setItemSeqChg('frmEventNoti'+idx, $('form[name="frmEventNoti'+idx+'"] input[name="itm_seq"]').val()));	// 품목 순번(old)
 	//$('form[name="frmEventNoti'+idx+'"] input[name="hope_seq_old"]').val($('form[name="frmEvfrmEventNotientDetail'+idx+'"] input[name="hope_seq"]').val());						// 희망 순번(old)
 	$('form[name="frmEventNoti'+idx+'"] input[name="rest_prvt_pt_old"]').val(rest_prvt_pt_old);																					// 차감 프라이빗 포인트(잔여 포인트 계산용 old)
 	$('form[name="frmEventNoti'+idx+'"] input[name="use_prvt_pt_old"]').val(use_prvt_pt_old);																					// 차감 프라이빗 포인트(이력 포인트 계산용 old)
 	$('form[name="frmEventNoti'+idx+'"] input[name="now_req_cnt_old"]').val(now_req_cnt_old);																					// 현재 신청 수(old)
 	$('form[name="frmEventNoti'+idx+'"] input[name="now_togat_ics_req_psn_cnt_old"]').val(now_togat_ics_req_psn_cnt_old);														// 현재 동반 포함 신청 인원(old)
 	$('form[name="frmEventNoti'+idx+'"] input[name="itm_grp_seq"]').val(rtn_itm_grp_seq);																						// 품목 그룹 순번
 	$('form[name="frmEventNoti'+idx+'"] input[name="itm_seq"]').val(rtn_itm_Seq);																								// 품목 순번
 	$('form[name="frmEventNoti'+idx+'"] input[name="hope_seq"]').val(rtn_hope_Seq);																								// 희망 순번
 	$('form[name="frmEventNoti'+idx+'"] input[name="pt_duct_except_yn"]').val(pt_duct_except_yn);																				// 포인트 차감 제외 여부
 	$('form[name="frmEventNoti'+idx+'"] input[name="duct_prvt_pt"]').val(duct_prvt_pt);																							// 차감 프라이빗 포인트
 	$('form[name="frmEventNoti'+idx+'"] input[name="rest_prvt_pt"]').val(rest_prvt_pt);																							// 차감 프라이빗 포인트(잔여 포인트 계산용)
 	$('form[name="frmEventNoti'+idx+'"] input[name="use_prvt_pt"]').val(use_prvt_pt);																							// 차감 프라이빗 포인트(이력 포인트 계산용)
 	$('form[name="frmEventNoti'+idx+'"] input[name="now_req_cnt"]').val(now_req_cnt);																							// 현재 신청 수
 	$('form[name="frmEventNoti'+idx+'"] input[name="now_togat_ics_req_psn_cnt"]').val(now_togat_ics_req_psn_cnt);																// 현재 동반 포함 신청 인원
 	$('form[name="frmEventNoti'+idx+'"] input[name="rsrv_togat_psn_cnt"]').val(rtn_togatman_psn_cnt);																			// 예약 동반 인원
 	$('form[name="frmEventNoti'+idx+'"] input[name="rsrv_dt"]').val(rsrv_dt);																									// 예약일자 
 	$('form[name="frmEventNoti'+idx+'"] input[name="rsrv_tm"]').val(rsrv_tm);																									// 예약시간
 	$('form[name="frmEventNoti'+idx+'"] input[name="hope_recv_recv_dt"]').val(rtn_hope_recv_recv_dt);																			// 희망 수령 접수 일자
 	
 	/*아트&컬쳐의 혜택유형의 속성이 '문화이벤트'일 경우 사용자가 선택한 희망일을 예약일에 넣어주고 희망수령일은 빈값으로 저장*/
 	if($('form[name="frmEventNoti'+idx+'"] input[name="upper_catg_cd"]').val() == '1' && $('form[name="frmEventNoti'+idx+'"] input[name="bene_gubun_cd"]').val() == '01'){
 		$('form[name="frmEventNoti'+idx+'"] input[name="rsrv_dt"]').val(rtn_hope_recv_recv_dt);							// 예약일자 
 	 	$('form[name="frmEventNoti'+idx+'"] input[name="rsrv_tm"]').val(rtn_hope_tm);									// 예약시간
 	 	$('form[name="frmEventNoti'+idx+'"] input[name="hope_recv_recv_dt"]').val('');									// 희망 수령 접수 일자	
 	}else{
 		$('form[name="frmEventNoti'+idx+'"] input[name="rsrv_dt"]').val('');										// 예약일자 
 	 	$('form[name="frmEventNoti'+idx+'"] input[name="rsrv_tm"]').val('');										// 예약시간
 	 	$('form[name="frmEventNoti'+idx+'"] input[name="hope_recv_recv_dt"]').val(rtn_hope_recv_recv_dt);				// 희망 수령 접수 일자	
 	}
 	
 	$('form[name="frmEventNoti'+idx+'"] input[name="recv_cust_nm"]').val(rtn_recv_cust_nm);																						// 수령 고객명
 	$('form[name="frmEventNoti'+idx+'"] input[name="recv_tel"]').val(rtn_recv_tel);																								// 수령 전화
 	$('form[name="frmEventNoti'+idx+'"] input[name="recv_tel2"]').val(rtn_recv_tel2);																							// 수령 전화2
 	$('form[name="frmEventNoti'+idx+'"] input[name="post_no"]').val(rtn_post_no);																								// 우편 번호
 	$('form[name="frmEventNoti'+idx+'"] input[name="recv_addr1"]').val(rtn_recv_addr1);																							// 수령 주소1
 	$('form[name="frmEventNoti'+idx+'"] input[name="recv_addr2"]').val(rtn_recv_addr2);																							// 수령 주소2
 	$('form[name="frmEventNoti'+idx+'"] input[name="prvtinf_arge_yn"]').val(rtn_prvtinf_arge_yn);																				// 개인정보 동의 여부
 	$('form[name="frmEventNoti'+idx+'"] input[name="deli_bigo"]').val(rtn_deli_bigo);																							// 배송 비고
 	$('form[name="frmEventNoti'+idx+'"] input[name="etcInfo"]').val(rtn_etcInfo);																								// 기타정보
 	$('form[name="frmEventNoti'+idx+'"] input[name="old_pasg_id"]').val(rtn_old_pasg_id);																						// 기존 인원 정보
 	$('form[name="frmEventNoti'+idx+'"] input[name="cur_pasg_id"]').val(rtn_cur_pasg_id);																						// 변경 인원 정보
 	$('form[name="frmEventNoti'+idx+'"] input[name="recv_store_cd"]').val(rtn_store_cd);								// 수령 지점
 	
 	
	var param = $('form[name=frmEventNoti'+idx+']').serialize();
	$.ajax({
		type: 'POST',
   		url: 'http://vipm.shinsegae.com/vipmobile/event/updEvent.do',
   		data: param,
  	  	dataType: 'json',
  	  	async : true,	// true:비동기, false:동기
  	  	cache : false,
	  	timeout : 30000,
  	  	success : function(data) {
  	  		if(data.MSG_CODE == "SUCCESS"){
	  	  		if(data.cnt > 0){
					// 이벤트 신청완료 페이지이동
					$('form[name="frmEventNoti'+idx+'"] input[name="chkUpd"]').val(rtnChkUpd);
					if('' != data.req_no) $('form[name="frmEventNoti'+idx+'"] input[name="req_no"]').val(data.req_no);
	  	  			$('form[name="frmEventNoti'+idx+'"]').attr('action', 'http://vipm.shinsegae.com/vipmobile/event/eventComplete.do').attr('method', 'post').submit();
	  	  		}
	  	  	}
			else if(data.MSG_CODE.startsWith("LAST_USE_STS_CHG"))
			{
				fn_messagePop('<p>신청 상태 혜택만 변경이 가능합니다.</p>', cbRefresh);
				return;					
			}	  	  	
			else if(data.MSG_CODE.startsWith("RSRV_CHECK_FAIL"))
			{
				fn_messagePop('<p>예약하신 날짜가 지나 수정할 수 없습니다.</p>', cbRefresh);
				return;
			}
			else if(data.MSG_CODE.startsWith("HOPE_DT_EXEC_DT_ERROR"))
			{
				fn_messagePop('<p>일자가 잘못되었습니다.\n사용기간내에서 입력해 주세요.</p>', cbRefresh);
				return;
			}		  	  	
			else if(data.MSG_CODE.startsWith("DT_CHECK_ERROR"))
			{
				fn_messagePop('<p>신청이 불가능한 일자 입니다.</p>', cbRefresh);
				return;
			}	
			else if(data.MSG_CODE.startsWith("GIFT_MODI_CHK_FAIL"))
			{
				fn_messagePop('<p>희망일 3일전 또는 배송확정전 까지만 신청정보 수정이 가능합니다.</p>', cbRefresh);
				return;
			}	
			else if(data.MSG_CODE.startsWith("GIFT_MODI_CHK2_FAIL"))
			{
				fn_messagePop('<p>실물 배송 이벤트의 경우 신청 당일에만 변경이 가능합니다.</p>', cbRefresh);
				return;
			}		  	  	
			else{
				fn_AlertMsg(data);
			}
		}
	});
}

// 찜하기
function heartToggle() {
	var req_limit_gubun_cd = $('form[name="frmEventDetail"] input[name="req_limit_gubun_cd"]').val();
	var VOUCH_CD = $('form[name="frmEventDetail"] input[name="bene_cd"]').val();
	var VOUCH_SEQ = $('form[name="frmEventDetail"] input[name="bene_creat_seq"]').val();
	var VOUCH_CATG_CD = $('form[name="frmEventDetail"] input[name="upper_catg_cd"]').val();
	var VOUCH_CATG_NM = $('form[name="frmEventDetail"] input[name="upper_catg_nm"]').val();
	var VOUCH_CATG_DTM = $('form[name="frmEventDetail"] input[name="bene_catg_nm"]').val();
	var VOUCH_VIEW_URL = '/event/eventDetail.do%3Fupper_catg_cd=' + VOUCH_CATG_CD + '%26bene_cd=' + VOUCH_CD + '%26bene_creat_seq=' + VOUCH_SEQ + '%26req_limit_gubun_cd=' + req_limit_gubun_cd;
	var img_path_ip = $('form[name="frmEventDetail"] input[name="IMG_PATH_IP"]').val();
	var attachment_path = $('form[name="frmEventDetail"] input[name="ATTACHMENT_PATH"]').val();
	var attachment_nm = $('form[name="frmEventDetail"] input[name="LIST_ATTACHMENT_NM"]').val();
	var VOUCH_IMG_URL = img_path_ip+attachment_path+attachment_nm;
	var VOUCH_SBJT = $('form[name="frmEventDetail"] input[name="event_nm"]').val();
	var VOUCH_DUE_STRT_DT = $('form[name="frmEventDetail"] input[name="exec_strt_dt"]').val();
	var VOUCH_DUE_END_DT = $('form[name="frmEventDetail"] input[name="exec_strt_tm"]').val();
	var VOUCH_DEL_RSRV_DT = $('form[name="frmEventDetail"] input[name="DEL_RSRV_DT"]').val();
	var VOUCH_SAVE_GUBUN = '';	
	var VOUCH_DISP_DT  = $('form[name="frmEventDetail"] input[name="exec_dt"]').val();
	var VOUCH_PV_POINT  = $('form[name="frmEventDetail"] input[name="max_use_cnt_pt"]').val();
		
	if ($('#heart').hasClass('like') == true) {
		VOUCH_SAVE_GUBUN = 'D';		
	} else {
		VOUCH_SAVE_GUBUN = 'I';		
	}

	var param = {};
	param.VOUCH_CD = VOUCH_CD;
	param.VOUCH_SEQ = VOUCH_SEQ;
	param.VOUCH_CATG_CD = VOUCH_CATG_CD;
	param.VOUCH_CATG_NM = VOUCH_CATG_NM;
	param.VOUCH_CATG_DTM = VOUCH_CATG_DTM;
	param.VOUCH_VIEW_URL = VOUCH_VIEW_URL;
	param.VOUCH_IMG_URL = VOUCH_IMG_URL;
	param.VOUCH_SBJT = VOUCH_SBJT;
	param.VOUCH_DUE_STRT_DT = VOUCH_DUE_STRT_DT;
	param.VOUCH_DUE_END_DT = VOUCH_DUE_END_DT;
	param.VOUCH_DEL_RSRV_DT = VOUCH_DEL_RSRV_DT;
	param.VOUCH_SAVE_GUBUN = VOUCH_SAVE_GUBUN;
	param.VOUCH_DISP_DT = VOUCH_DISP_DT;
	param.VOUCH_PV_POINT = VOUCH_PV_POINT;	
	
	$.ajax({
		type: 'POST',
   		url: 'http://vipm.shinsegae.com/vipmobile/event/likeSave.do',
   		data: param,
  	  	dataType: 'json',
  	  	async : true,	// true:비동기, false:동기
  	  	cache : false,
	  	timeout : 30000,
  	  	success : function(data) {
  	  		$('#heart').toggleClass('like');
  	  		fnCallRefresh();
		}
	});
}

function fnGoList() {
	var evtRoot = $("#EVT_ROOT").val();
	if (evtRoot == 'HISTORY') {
		fn_urlRedirect('http://vipm.shinsegae.com/vipmobile/history/historyEvent.do?upper_catg_cd=' + $("#upper_catg_cd").val());
	} else if (evtRoot == 'SPECIALS') {
		fn_urlRedirect('http://vipm.shinsegae.com/vipmobile/specials/main.do?CATG_CD=' + $("#THESPECIAL_CATG_CD").val());
	} else {
		fn_urlRedirect('http://vipm.shinsegae.com/vipmobile/event/main.do');	
	}	
}

function fnUseComplete() {
	fn_messagePop('<p>사용이 완료되었습니다.</p>', fnGoList);	
}

function fnGoHome() {
	location.href = 'toApp:CLOSE';
}

//처리결과 메세지
function fn_AlertMsg(result){
	var msg = "";
	if(result.MSG_CODE.startsWith("RECV_DT_FAIL"))
	{
		msg = "<p>신청가능일이 아닙니다.</p>" ;
	}		
	else if(result.MSG_CODE.startsWith("CHG_DT_FAIL"))
	{
		msg = "<p>변경 가능 기간이 아닙니다.</p>" ;
	}	
	else if(result.MSG_CODE.startsWith("CANCEL_DT_FAIL"))
	{
		msg = "<p>취소 가능 기간이 아닙니다.</p>" ;
	}		
	else if(result.MSG_CODE.startsWith("GRD_MAX_LIMIT_FAIL"))
	{
		msg = "<p>최대 이용기준을 초과 했습니다.</p>" ;
	}
	else if(result.MSG_CODE.startsWith("REST_PT_FAIL"))
	{
		msg = "<p>사용가능한 프라이빗 포인트가 부족합니다.</p>" ;
	}	
	else if(result.MSG_CODE.startsWith("REQ_LIMIT_FAIL"))
	{
		msg = "<p>신청제한 수를 초과 했습니다.</p>" ;
	}	
	else if(result.MSG_CODE.startsWith("WAIT_LIMIT_FAIL"))
	{
		msg = "<p>대기제한 수를 초과 했습니다.</p>" ;
	}	
	else if(result.MSG_CODE.startsWith("HOPE_SEQ_NULL") )
	{
		msg = "<p>일자정보가 잘못되었습니다.</p>" ;
	}	
	else if(result.MSG_CODE.startsWith("REQUEST_ITM_FAIL"))
	{
		msg = "<p>처리된 내역이 없습니다.</p>" ;
	}							
	else if(result.MSG_CODE.startsWith("REQUEST_FAIL"))
	{
		msg = "<p>처리된 내역이 없습니다.</p>" ;
	}		
	else if(result.MSG_CODE.startsWith("LAST_USE_STS_USE"))
	{
		msg = "<p>이미 사용한 혜택 입니다.</p>" ;
	}		
	else if(result.MSG_CODE.startsWith("LAST_USE_STS_CANCEL"))
	{
		msg = "<p>이미 취소된 내역입니다.</p>" ;
	}
	else if(result.MSG_CODE.startsWith("EVENT_CANCEL"))
	{
		msg = "<p>이벤트가 종료되었습니다.</p>" ;
	}
	else if(result.MSG_CODE.startsWith("ITMGRP_UNABLE"))
	{
		msg = "<p>신청할수 없는 등급입니다.</p>" ;
	}	
	else if(result.MSG_CODE.startsWith("PRVT_PT_MINUS"))
	{
		msg = ("<p>잔여 프라이빗 포인트가 마이너스입니다.<p>" );
	}			
	else
	{
		msg = "<p>관리자에게 문의해주세요.</p>" ;
	}
	
	if(msg != ""){
		fn_messagePop(msg, cbRefresh);
	}
}

function fnStaffConfirm(idx) {
	var $layer_popup1 = $('<div class="layer_popup_confirm"><div class="layer_bx_confirm"></div></div>');	// 전체 화면 팝업
	var styles1 = {width : '100%', height : '100%'};										// iframe 사이즈 정의
	var $layer_close = $('<a href="#" class=btn_confirm_close title="닫기"></a>');
	$('body').append($layer_popup1);
	$layer_popup1.append($layer_close);
	$('.layer_popup_confirm').css(styles1);
	
	var bene_cd = $('form[name="frmEventNoti'+idx+'"] input[name="bene_cd"]').val();
	var bene_creat_seq = $('form[name="frmEventNoti'+idx+'"] input[name="bene_creat_seq"]').val();
	var req_no = $('form[name="frmEventNoti'+idx+'"] input[name="req_no"]').val();
	var itm_seq = $('form[name="frmEventNoti'+idx+'"] input[name="itm_seq"]').val();
	var bcd_seq = $('#bcd_seq').val();
	
	// 고객정보 입력 팝업
	$('.layer_popup_confirm').bPopup({
		contentContainer : '.layer_bx_confirm',
		content : 'iframe',
		loadUrl : 'http://vipm.shinsegae.com/vipmobile/event/staffConfirmPop.do' +
				 	'?bene_cd='+bene_cd +
					'&bene_creat_seq='+bene_creat_seq +
					'&itm_seq='+itm_seq +
					'&bcd_seq='+bcd_seq +
					'&req_no='+req_no,
		closeClass : 'btn_confirm_close',
		onClose: function(){
			$('body').unbind('touchmove');	// touch event제거
		}
	});	
}

var delay = 500;
var clicked = false;
$(function() {
	// 버튼 press 처리
	$('button').bind('touchstart',function(e){
		$(this).addClass("active");
	});
	$('button').bind('touchend',function(e){
		$(this).removeClass('active');
	});
	
	// 스와이프
	var swiper = new Swiper('.swiper-container', {
		pagination: '.swiper-pagination',
		paginationClickable: true
	});
	
	// 스와이프
	var swiperBarcode = new Swiper('.barcode_swiper_container', {
		pagination : '.barcode_swiper_pagination',
		paginationClickable : true
	});
	
	// 노티 영역
   	if($('form[name="frmEventDetail"] input[name="req_cnt"]').val() <= 0){
   		$('.detail_bx').hide();
   		$('.btn_noti').attr('title', '이용내역 열기');
   	}else if($('form[name="frmEventDetail"] input[name="req_cnt"]').val() > 0){
   		$('.dim').css('opacity',.8);
   		$('.btn_noti').addClass('open');
   		$('.btn_noti').attr('title', '이용내역 닫기');
   	}

	$('.btn_noti').click(function(e){
		$('.detail_bx').slideToggle(250,'swing');
		$(this).toggleClass('open');
		var nstyle = $('.top_bx .dim').css('opacity');
		if(nstyle == '0'){
			$('.dim').animate({'opacity':0.8});
		}else{
			$('.dim').animate({'opacity':0});
		}
		
		//웹접근성 조치사항
		if($(this).hasClass('open') == true) {
			$('.btn_noti').attr('title', '이용내역 닫기');
		}else{
			$('.btn_noti').attr('title', '이용내역 열기');
		}
	});
	
	// Dim 터치 시 노티영역 닫힘
	$('.dim').bind('touchstart',function(e){
		$('.detail_bx').slideUp();
		$('.dim').animate({'opacity':0});
		$('.dim').unbind('click');
	});
	
	// NEXT CONTENTS로 이동
	$('.next_cont').bind('click', function(e){
		nextEventDetail();
	});
	
	hideStep1();
	
	$('#step1ReqPop_bx').on('scroll touchmove mousewheel', function(e) {
	   e.preventDefault();
	   e.stopPropagation(); 
	   return false;
	});
});

function fnClickInit() {
	clicked = false;
}

//드롭다운 리스트 선택
function step1DropDownSelected(obj){
	var name = obj.children().eq(0).get(0).name;				// 선택된 셀렉트 박스 이름
	var value = obj.children().eq(0).get(0).value;				// 선택된 셀렉트 박스 값
	var textContent = obj.children().eq(1).get(0).textContent;	// 선택된 셀렉트 박스에 해당되는 텍스트
	var id = obj.parent().parent().prev().get(0).id;			// 선택된 텍스트 값이 보여지는 아이디
	
	$('input:radio[name="'+name+'"]').attr("checked", false);
	$('input:radio[name="'+name+'"]:radio[value="'+value+'"]').attr('checked', true);
	$('#'+id+'').text(textContent);
	
	if('selItemGroup' == id) {
		step1GetItem(value);
	}
	if('selPassenger' == id) {
		$('form[name="frmStep1ReqPop"] input[name="rsrv_togat_psn_cnt"]').val(value);
	}
}

//품목 조회
function step1GetItem(itm_grp_seq){
	$('form[name="frmStep1ReqPop"] input[name="bene_cd"]').val($('#bene_cd').val());
	$('form[name="frmStep1ReqPop"] input[name="bene_creat_seq"]').val($('#bene_creat_seq').val());
	$('form[name="frmStep1ReqPop"] input[name="itm_grp_seq"]').val(itm_grp_seq);
	
	var param = $('form[name="frmStep1ReqPop"]').serialize();
	$.ajax({
		type: 'POST',
   		url: 'http://vipm.shinsegae.com/vipmobile/event/getItem.do',
   		data: param,
  	  	dataType: 'json',
  	  	async : true,	// true:비동기, false:동기
  	  	cache : false,
	  	timeout : 30000,
  	  	success : function(data) {
  	  		var arrList = data.list;
	  	  	var itemArr = new Array();
	  		var itemInfo = new Object();
	  		
	  		var deliCatgArr = new Array();		// 품목그룹 안에서 배송 분류코드 달라지는것 체크 
	  		
  			var deli_catg_cd_temp = '';
  			var duct_prvt_pt_sum = 0;
  			
  	  		$.each(arrList, function(index, item) {
				var itm_seq = fn_chkNull(item.ITM_SEQ);				// 품목 순번
				var deli_catg_cd = fn_chkNull(item.DELI_CATG_CD);	// 배송 분류 코드
				var duct_prvt_pt = fn_chkNull(item.DUCT_PRVT_PT);	// 차감 프라이빗 포인트
				
				var tempInfo = new Object();
				tempInfo['itm_seq'] = itm_seq.toString();
				itemArr.push(tempInfo);
				
				/*배송분류코드 품목별로 담기*/
				deliCatgArr.push(deli_catg_cd.toString());
				
				deli_catg_cd_temp = deli_catg_cd;
				duct_prvt_pt_sum += duct_prvt_pt;
			});
  	  		
  	  		itemInfo.itemInfo = itemArr;
  	  		var itm_seq = JSON.stringify(itemInfo);
  	  		
  	  		/*품목그룹 안에 품목이 한개보다 많을때만 체크*/
  	  		var deliCatgCdValid = "true";
  	  		if(deliCatgArr.length > 1){
  	  	  		var uniq = deliCatgArr.reduce(function(a,b){
  	  	  			if(a.indexOf(b) < 0) a.push(b);
  	  	  			return a;
  	  	  		}, []);
  	  	  		
  	  	  		if(uniq.length != 1) deliCatgCdValid = "false"; 
  	  		}
  	  		
  	  		//alert("품목별 배송유형이 다 같은가? : "+deliCatgCdValid);
  	  		
			$('form[name="frmStep1ReqPop"] input[name="itm_seq"]').val(itm_seq);
			$('form[name="frmStep1ReqPop"] input[name="deli_catg_cd"]').val(deli_catg_cd_temp);
			$('form[name="frmStep1ReqPop"] input[name="duct_prvt_pt"]').val(duct_prvt_pt_sum);
			$('form[name="frmStep1ReqPop"] input[name="deli_catg_cd_valid"]').val(deliCatgCdValid);
		}
	});
}

//신청
function step1Confirm(){	
	//alert("STEP2 000 step1Confirm 진입");
	
	
	var bene_catg_cd = '';
	var bene_cd = '';
	var bene_creat_seq = '';
	var req_no = '';
	var upper_catg_cd = '';
	var itm_grp_seq = '';
	
	// 신청
	if(!rtnChkUpd){	
		bene_catg_cd = $('form[name="frmEventDetail"] input[name="bene_catg_cd"]').val();
		bene_cd = $('form[name="frmEventDetail"] input[name="bene_cd"]').val();
		bene_creat_seq = $('form[name="frmEventDetail"] input[name="bene_creat_seq"]').val();
		upper_catg_cd = $('form[name="frmEventDetail"] input[name="upper_catg_cd"]').val();
		itm_grp_seq = $('form[name="frmEventDetail"] input[name="itm_grp_seq"]').val();
	// 수정
	}else{
		bene_catg_cd = $('form[name="frmEventNoti'+idx+'"] input[name="bene_catg_cd"]').val();
		bene_cd = $('form[name="frmEventNoti'+idx+'"] input[name="bene_cd"]').val();
		bene_creat_seq = $('form[name="frmEventNoti'+idx+'"] input[name="bene_creat_seq"]').val();
		req_no = $('form[name="frmEventNoti'+idx+'"] input[name="req_no"]').val();
		upper_catg_cd = $('form[name="frmEventNoti'+idx+'"] input[name="upper_catg_cd"]').val();
		itm_grp_seq = $('form[name="frmEventNoti'+idx+'"] input[name="itm_grp_seq"]').val();
	}
	
	var selected_cnt = 0;		// 선택한 동반인원 포함 인원
	var reservation_cnt = 0;	// 예약한 동반인원 포함 인원
	
	if(!step1ChkVaild()) return false;	// 유효성 체크

	// 수정
	if(rtnChkUpd) {
 		reservation_cnt = Number($('form[name="frmEventNoti'+idx+'"] input[name="rsrv_togat_psn_cnt"]').val()) + 1;
	}
 	selected_cnt = Number($('input:radio[name="raPassenger"]:checked').val()) + 1;
	
 	var req_limit_gubun_cd = $('form[name="frmEventDetail"] input[name="req_limit_gubun_cd"]').val();
 	if(rtnChkUpd){
 		req_limit_gubun_cd = $('form[name="frmEventNoti'+idx+'"] input[name="req_limit_gubun_cd"]').val();
	}
 	
 	if("003" != req_limit_gubun_cd){
 		if(!chkEmptySeats(selected_cnt, reservation_cnt)) return false;	// 좌석 정보 체크
 	}	
 	
 	/*품목그룹순번 대신 기존 인원값, 변경 인원값 세팅 - 인원 선택값이 달라졌을경우 품목그룹이 달라진것 처럼 취급(delete->insert)*/
	rtn_cur_pasg_id = $('input:radio[name="raPassenger"]:radio[value="'+$('input:radio[name="raPassenger"]:checked').val()+'"]').attr('id');
	if(rtn_old_pasg_id == '') rtn_old_pasg_id = rtn_cur_pasg_id;
	
	rtnReqVal = true;																		// 구분값
	rtnHopeDtNone = true;
	rtn_itm_grp_seq = $('form[name="frmStep1ReqPop"] input[name="itm_grp_seq"]').val();		// 품목 그룹 순번(코스)
	rtn_itm_Seq = $('form[name="frmStep1ReqPop"] input[name="itm_seq"]').val();				// 품목 순번
	rtn_deli_catg_cd = $('form[name="frmStep1ReqPop"] input[name="deli_catg_cd"]').val();	// 배송 분류 코드
	rtn_duct_prvt_pt = $('form[name="frmStep1ReqPop"] input[name="duct_prvt_pt"]').val();	// 차감 프라이빗 포인트
	rtn_deli_catg_cd_valid = $('form[name="frmStep1ReqPop"] input[name="deli_catg_cd_valid"]').val();	// 배송 분류 코드 구분(품목그룹안의 품목들의 배송분류코드가 모두 같으면 true 하나라도 다르면 false)
	rtn_togatman_psn_cnt = $('#rsrv_togat_psn_cnt').val();
	if (rtn_togatman_psn_cnt == '') {
		rtn_togatman_psn_cnt = 0;
	}
	
	hideStep1();
	
	
	//alert("STEP2 001 진입");
	//STEP2
	if(rtnReqVal){
		/*품목그룹 안의 품목들의 배송분류코드가 모두 같을때만 신청가능*/
		if(rtn_deli_catg_cd_valid != "false"){	
			
			/*품목그룹안의 품목의 희망일구분, 희망일 체크
				(희망일 구분이 모두 같아야하고
				 희망일 구분이 희망일 지정일 경우에는 BO에서 설정한 희망일 날짜가 시간까지 모두 같아야함)
			*/
			
			//alert("STEP2 002 진입");			
			if('Y' == isHopeDtValid(bene_cd, bene_creat_seq, rtn_itm_grp_seq)){	
				//alert("STEP2 003 진입");					
				/*품목그룹안의 품목들의 희망일구분, 희망일이 모두 같다는 전제하에 배송유형별로 체크함*/
				if('1' == rtn_deli_catg_cd){	/* 배송유형 실물배송_______START*/
					if(hopeDtUseCd != '001'){
						/*희망일 지정, 사용기간내 사용자 입력일때 -> 희망일 선택 -> 배송지 입력 -> 기타정보 -> 신청*/
						step2ReqPop(bene_cd, bene_creat_seq, rtn_itm_Seq);
					} else {
						step3ReqPop();
					}
					/* 배송유형 실물배송_______END*/
				} else if('2' == rtn_deli_catg_cd) {
					/*배송유형 내점수령_______START*/
					step2ReqPop(bene_cd, bene_creat_seq, rtn_itm_Seq);
	    			/*배송유형 내점수령_______END*/
				} else if('3' == rtn_deli_catg_cd) {
					/*배송유형 모바일쿠폰_______START*/
					/*희망일 지정, 사용기간내 사용자 입력일때 -> 희망일 선택 -> 기타정보 -> 신청*/
					if(hopeDtUseCd != '001'){
						step2ReqPop(bene_cd, bene_creat_seq, rtn_itm_Seq);
					}else{
						/*희망일 지정 없음 -> 기타정보 -> 신청*/
						/*기타정보 입력 체크*/
						if('Y' == $('form[name="frmEventDetail"] input[name="ETC_INFO_YN"]').val()){
							/*인원정보도 수정했을때 req_no를 초기화해서 보내줌(기존에 입력했던 기타정보 안씀)*/
		    				if(rtnChkUpd == true && rtn_old_pasg_id != rtn_cur_pasg_id) req_no = '';
		    				
		    				var $layer_popup1 = $('<div class="layer_popup1"><div class="layer_bx1"></div></div>');	// 전체 화면 팝업
				    		var styles1 = {width : '100%', height : '100%'};										// iframe 사이즈 정의
				    		var $layer_close = $('<a href="#" class=btn_close title="닫기"></a>');
				    		$('body').append($layer_popup1);
				    		$layer_popup1.append($layer_close);
				    		$('.layer_popup1').css(styles1);
				    		
				    		// 기타정보 입력 화면
			    			$('.layer_popup1').bPopup({
			    				contentContainer : '.layer_bx1',
			    				content : 'iframe',
			    				modalColor : '#fff',
			    				opacity : 1,
			    				loadUrl : 'http://vipm.shinsegae.com/vipmobile/event/eventPersonalInfoPop.do' +
			    						'?bene_cd='+bene_cd +						// 혜택 코드
			    						'&bene_creat_seq='+bene_creat_seq +			// 혜택 생성 순번
			    						'&idx='+idx +								// 인덱스 번호
			    						'&togatman_psn_cnt='+rtn_togatman_psn_cnt +	// 동반자 인원
			    						'&chkUpd='+rtnChkUpd+						// 신청, 수정구분
			    						'&req_no='+req_no+							// 신청번호
			    						'&old_pasg_id='+rtn_old_pasg_id+			// 기존 인원정보
			    						'&cur_pasg_id='+rtn_cur_pasg_id,			// 변경 인원정보
			    				closeClass : 'btn_close',
			    				onClose: function(){
			    					$('body').unbind('touchmove');	// touch event제거
			    					
			    					if(rtnReqVal){
			    						if(!rtnChkUpd) insEvent();
	 		    		    			if(rtnChkUpd) updEvent(idx);
			    					}
			    				}
			    			});
						}else{
							/*신청/수정*/
							if(!rtnChkUpd) {
								insEvent();
							} else {
								updEvent(idx);
							}
						}
					}
				}/*배송유형 모바일쿠폰_______END*/
			}else{
				fn_messagePop('<p>품목별 희망일이 다릅니다.<br>컨시어지 또는 콜센터에<br>문의하세요.</p>');
				return;
			}
		}else{
			fn_messagePop('<p>품목별 수령방법이 다릅니다.<br>컨시어지 또는 콜센터에<br>문의하세요.</p>');
			return;
		}
	}
}

//유효성 체크
function step1ChkVaild(){
	if($('#itm_grp_seq').val() == ''){
		fn_messagePop('<p>품목 그룹을 선택해주세요.</p>');
		return false;
	}else if(Number($('form[name="frmEventDetail"] input[name="rest_prvt_pt"]').val()) < Number($('form[name="frmStep1ReqPop"] input[name="duct_prvt_pt"]').val())){
		fn_messagePop('<p>프라이빗 포인트가 부족합니다.</p>');
		return false;
	}else if($('form[name=frmEventDetail] input[name=togatman_psn_cnt]').val() > 0 && $('#rsrv_togat_psn_cnt').val() == ''){
		fn_messagePop('<p>인원을 선택해주세요.</p>');
		return false;
	}
	
	return true;
}

// STEP2 (지점, 희망일 선택)
function step2ReqPop(bene_cd, bene_creat_seq, itm_Seq) {

	
	var hopeHtml = '';
	var param = {};
	param.bene_cd = bene_cd;
	param.bene_creat_seq = bene_creat_seq;
	param.itm_seq = JSON.parse(itm_Seq).itemInfo[0].itm_seq;
						
	$.ajax({
		type: 'POST',
   		url: 'http://vipm.shinsegae.com/vipmobile/event/getHopeDtStore.do',
   		data: param,
  	  	dataType: 'json',
  	  	async : true,	// true:비동기, false:동기
  	  	cache : false,
	  	timeout : 30000,
  	  	success : function(data) {
  	  		var hoptDtList = data.hopeDtList;
  	  		var storeCdList = data.storeCdList;
  	  		
  	  		$('#hopeDt_info dl').remove();
  	  		
  	  		//예약 날짜를 선택해주세요
  	  		var storeYn = false;
  	  		var hopeYn = false;
  	  		var tStoreCd = "";
  	  		/*배송유형 내점수령일 경우만 수령점포 selectbox표출됨*/
	  	  	if(rtn_deli_catg_cd == '2') {
	  	  		
	  	  		//alert("점포갯수 : " + storeCdList.length);
	  	  		if(storeCdList.length == 1){
	  	  			tStoreCd = storeCdList[0].STORE_CD;
	  	  		}else if(storeCdList.length > 1) {
					storeYn = true;
					storeHtml = '<dl class="storeCdSelect">';
					storeHtml += '<dt>수령점포</dt>';
					storeHtml += '<dd>';
					
					storeHtml += '<select name="storeCd" id=storeCd title="수령점포" id="storeCd">';
					storeHtml += '<option value="" endFlag="">점포선택 (수령장소)</option>';
					$.each(storeCdList, function(index, item) {
						storeHtml += '<option value="' + item.STORE_CD + '">' + item.STORE_NM + ' (' + item.RECV_SPT + ')</option>';
					});
					
					hopeHtml += '</dd>';
					hopeHtml += '</dl>';
					
					$('#hopeDt_info').append(storeHtml);
  	  			}	
	  	  	}	
  	  		
  	  		if (hopeDtUseCd == '002') {
  	  			hopeYn = true;
  	  			hopeHtml = '<dl class="hopeDtSelect">';
	  			hopeHtml += '<dt>날짜</dt>';
	  			hopeHtml += '<dd>';
	  			hopeHtml += '<select name="hopeDt" title="날짜선택" id="hopeDt">';

	  	  		if(hoptDtList.length > 0) {
	  	  		   	hopeHtml += '<option value="" endFlag="">날짜 선택</option>';
	  	  			$.each(hoptDtList, function(index, item) {
		  	  			if (item.ENDFLAG == 'END') {
		  	  				hopeHtml += '<option value="' + item.HOPE_SEQ + '" endFlag="' + item.ENDFLAG + '" hope_recv_recv_dt="' + item.HOPE_DT_REAL + '" hope_tm="' + item.HOPE_TM + '" hope_dt_tm="' + item.HOPE_DT_REAL + item.HOPE_TM + '">' + item.HOPE_DT_TM + '(마감)</option>';
						} else {
							hopeHtml += '<option value="' + item.HOPE_SEQ + '" endFlag="' + item.ENDFLAG + '" hope_recv_recv_dt="' + item.HOPE_DT_REAL + '" hope_tm="' + item.HOPE_TM + '" hope_dt_tm="' + item.HOPE_DT_REAL + item.HOPE_TM + '">' + item.HOPE_DT_TM + '</option>';
						}
					});
	  	  		}
	  	  		
		  	  	hopeHtml += '</select>';
				hopeHtml += '</dd>';
				hopeHtml += '</dl>';
		  	  	$('#hopeDt_info').append(hopeHtml);
			} else if (hopeDtUseCd == '003') {
				hopeYn = true;	
				hopeHtml = '<dl class="hope">';
				hopeHtml += '<dt>날짜</dt>';
				hopeHtml += '<dd>';
				hopeHtml += '<input type="date" name="hopeDt" id="hopeDt" />';
				hopeHtml += '</dd>';
				hopeHtml += '</dl>';
				$('#hopeDt_info').append(hopeHtml);
			}

  	  		if (storeYn == false && hopeYn == false && tStoreCd !="" ) {
  	  			//점포가 1개 인 경우 
  	  			step2Confirm(tStoreCd);
  	  		}else if (storeYn == true && hopeYn == true) {
  	  			setVisiblity('step2ReqPop', true);
  	  		
  	  			$('#step2title').html('수령점포<br>예약날짜');
  	  			$('#step2subtitle').html('수령 점포와 예약 날짜를 선택해주세요.');
  	  		}else if (storeYn == true && hopeYn == false) {
  	  			setVisiblity('step2ReqPop', true);
  	  			
  	  			$('#step2title').html('수령<br>점포');
	  			$('#step2subtitle').html('수령 점포를 선택해주세요.');
  	  		}else if (storeYn == false && hopeYn == true) {
  	  			setVisiblity('step2ReqPop', true);
  	  			
  	  			$('#step2title').html('예약<br>날짜');
	  			$('#step2subtitle').html('예약 날짜를 선택해주세요.');
  	  		}else{
  	  			alert("이벤트 2단계 입력 정보를 찾을 수 없습니다. 관리자에게 문의 바랍니다.");
  	  		}
		}
	});
}

/*희망일이 사용기간내 있는지 체크*/
function step2IsHopeDtInExecDt(hopeDt){
	var rtnVal = 0;
	
	var year = $('form[name="frmEventDetail"] input[name="exec_strt_dt"]').val().substr(0,4);
	var month = $('form[name="frmEventDetail"] input[name="exec_strt_dt"]').val().substr(4,2);
	var date = $('form[name="frmEventDetail"] input[name="exec_strt_dt"]').val().substr(6);
	var startDt = new Date();
	startDt.setFullYear(year, month-1, date);
	startDt.setHours(0, 0, 0, 0);
	
	year = $('form[name="frmEventDetail"] input[name="exec_end_dt"]').val().substr(0,4);
	month = $('form[name="frmEventDetail"] input[name="exec_end_dt"]').val().substr(4,2);
	date = $('form[name="frmEventDetail"] input[name="exec_end_dt"]').val().substr(6);
	var endDt = new Date();
	endDt.setFullYear(year, month-1, date);
	endDt.setHours(0, 0, 0, 0);
	
	year = hopeDt.substr(0,4);
	month = hopeDt.substr(4,2);
	date = hopeDt.substr(6);
	hopeDt = new Date(hopeDt);
	hopeDt.setFullYear(year, month-1, date);
	hopeDt.setHours(0, 0, 0, 0);
	
	if(hopeDt < startDt || hopeDt > endDt) rtnVal = 1;
	
	var todayDt = new Date();
	todayDt.setFullYear(leadingZeros(todayDt.getFullYear(), 4), leadingZeros(todayDt.getMonth() + 1, 2) - 1, leadingZeros(todayDt.getDate(), 2));
	todayDt.setHours(0, 0, 0, 0);
	if(hopeDt < todayDt) rtnVal = 2;
		
	return rtnVal;
}

function step2Back() {
	setVisiblity('step2ReqPop', false);
}

function step2Confirm(tStoreCd) {
	if(!step2ChkVaildEvent()) {
		return false;	// 유효성 체크
	}
	
	rtnReqVal = true;																					// 구분값
	rtnHopeDtNone = true;
	
	if(hopeDtUseCd == '002'){
		rtn_hope_Seq = $('select[name="hopeDt"]').val();												// 희망 순번
		rtn_hope_recv_recv_dt = $('select[name="hopeDt"] option:selected').attr('hope_recv_recv_dt');	// 희망 수령 접수 일자
		rtn_hope_tm = $('select[name="hopeDt"] option:selected').attr('hope_tm');						// 선택한 희망일자의 시간
	}else if(hopeDtUseCd == '003'){	//사용기간내 사용자 선택일 경우
		rtn_hope_Seq = '';																				// 희망 순번
		rtn_hope_recv_recv_dt = $('input[type="date"]').val().replace(/-/gi, '');						// 희망 수령 접수 일자
		rtn_hope_tm = '';																				// 선택한 희망일자의 시간
	}
	//alert( "storeCd.val() : " + $("#storeCd").val() );
	//rtn_store_cd = $('select[name="storeCd"]').val();													// 수령점포 선택코드
	
	//점포가 1개 일때는 점포 정보를 넘겨 받음
	if(tStoreCd != ""){
		rtn_store_cd = tStoreCd; //점포가 1개일때 
	}else{
		rtn_store_cd = $("#storeCd").val();																	// 수령점포 선택코드
	}
		
	
	$('#step2ReqPop').hide();
	
	// 저장했으니깐 다음이 있는지 확인하자~
	if(rtnHopeDtNone){	/*선택할수있는 희망일이 있었을때만*/
		if(rtnReqVal){
			if('1' == rtn_deli_catg_cd) {
				step3ReqPop();
			} else {
				/*기타정보 입력 체크*/
				if('Y' == $('form[name="frmEventDetail"] input[name="ETC_INFO_YN"]').val()){
					var bene_cd = '';
					var bene_creat_seq = '';
					var req_no = '';
									
					// 신청
					if(!rtnChkUpd){	
						bene_cd = $('form[name="frmEventDetail"] input[name="bene_cd"]').val();
						bene_creat_seq = $('form[name="frmEventDetail"] input[name="bene_creat_seq"]').val();
					// 수정
					} else {
						bene_cd = $('form[name="frmEventNoti'+idx+'"] input[name="bene_cd"]').val();
						bene_creat_seq = $('form[name="frmEventNoti'+idx+'"] input[name="bene_creat_seq"]').val();
						req_no = $('form[name="frmEventNoti'+idx+'"] input[name="req_no"]').val();
					}
					
					/*인원정보도 수정했을때 req_no를 초기화해서 보내줌(기존에 입력했던 기타정보 안씀)*/
					if(rtnChkUpd == true && rtn_old_pasg_id != rtn_cur_pasg_id) {
						req_no = '';
					}
					
					var $layer_popup1 = $('<div class="layer_popup1"><div class="layer_bx1"></div></div>');	// 전체 화면 팝업
					var styles1 = {width : '100%', height : '100%'};										// iframe 사이즈 정의
					var $layer_close = $('<a href="#" class=btn_close title="닫기"></a>');
					$('body').append($layer_popup1);
					$layer_popup1.append($layer_close);
					$('.layer_popup1').css(styles1);
					
					// 기타정보 입력 화면
					$('.layer_popup1').bPopup({
						contentContainer : '.layer_bx1',
						content : 'iframe',
						modalColor : '#fff',
						opacity : 1,
						loadUrl : 'http://vipm.shinsegae.com/vipmobile/event/eventPersonalInfoPop.do' +
								'?bene_cd='+bene_cd +						// 혜택 코드
								'&bene_creat_seq='+bene_creat_seq +			// 혜택 생성 순번
								'&idx='+idx +								// 인덱스 번호
								'&togatman_psn_cnt='+rtn_togatman_psn_cnt +	// 동반자 인원
								'&chkUpd='+rtnChkUpd+						// 신청, 수정구분
								'&req_no='+req_no+							// 신청번호
								'&old_pasg_id='+rtn_old_pasg_id+			// 기존 인원정보
								'&cur_pasg_id='+rtn_cur_pasg_id,			// 변경 인원정보
						closeClass : 'btn_close',
						onClose: function(){
							$('body').unbind('touchmove');	// touch event제거
							
							if(rtnReqVal){
								if(!rtnChkUpd) {
									insEvent();
								} else {
					    			updEvent(idx);
					    		}
							}
						}
					});
				}else{
					/*신청/수정*/
					if(!rtnChkUpd) {
						insEvent();
					} else {
						updEvent(idx);
					}
				}	
			}
		}
	}else{
		fn_messagePop('<p>설정된 희망일이 없습니다.<br>컨시어지 또는 콜센터에<br>문의하세요.</p>');
		return;
	}
}

//유효성 체크
function step2ChkVaildEvent(){
	if($('select[name="hopeDt"] option:selected').val() == ''){
		fn_messagePop('<p>날짜를 선택해주세요.</p>');
		return false;
	}else if($('select[name="hopeDt"] option:selected').attr('endFlag') == "END"){
		fn_messagePop('<p>해당 날짜는 이미 마감되었습니다.<br>다른 날짜를 선택하세요.</p>');
		return false;
	}else if(rtn_deli_catg_cd == '2' && $('select[name="storeCd"] option:selected').val() == ''){
		fn_messagePop('<p>수령점포를 선택해주세요.</p>');
		return false;
	}else if(hopeDtUseCd == '003' && $('input[type="date"]').val().replace(/-/gi, '') == ''){
		fn_messagePop('<p>일자를 입력해주세요.</p>');
		return false;
	}else if(hopeDtUseCd == '003') {
		var result = step2IsHopeDtInExecDt($('input[type="date"]').val().replace(/-/gi, ''));
		if (result == 1) {
			fn_messagePop('<p>일자가 잘못되었습니다.<br>사용기간내에서 입력해 주세요.</p>');
			return false;
		} else if (result == 2) {
			fn_messagePop('<p>지난 일자로는 신청하실 수 없습니다.</p>');
			return false;
		}
	}
	
	return true;
}

// STEP3 배송지 입력
function step3ReqPop() {
	$('#termsPrivacy').prop("checked", false);
	$('#notermsPrivacy').prop("checked", false);
	step3SetAddress1();
	rtnReqVal = false;	// 초기화
	step3SetModValues();						// 수정 시 값 셋팅
	
	// 기존 배송지, 새로운 배송지 선택
	$('input:radio[name="address"]').bind('click', function(e){
		if($('#address1').is(':checked')){
			step3SetAddress1();
		}else if($('#address2').is(':checked')){
			step3SetAddress2();
		}
	});
	
	// iframe Popup
	var $layer_popup1 = $('<div class="layer_popup1"><div class="layer_bx1"></div></div>');	// 전체 화면 팝업
	var styles1 = {width : '100%', height : '100%'};										// iframe 사이즈 정의
	var $layer_close1 = $('<a href="#" class="btn_close1" title="닫기"></a>');
	
	// 개인정보 수집 및 이용동의
	$('.btn_terms').bind('click', function(e) {
		$("body").append($layer_popup1);
		$layer_popup1.append($layer_close1);
		e.preventDefault();
		$('.layer_popup1').css(styles1);
		$('.layer_popup1').bPopup({
			contentContainer : '.layer_bx1',
			content : 'iframe',
			modalColor : '#fff',
			opacity : 1,
			loadUrl : 'http://vipm.shinsegae.com/vipmobile/event/eventAddressTermsPop.do',
			closeClass : 'btn_close1',
			onClose: function(){
				$('body').unbind('touchmove');	// touch event제거
			}
		});
		$("body").bind("touchmove", function(e){e.preventDefault()});
	});
	
	// 주소검색
	$('.btn_postcode').bind('click', function(e) {
		stepAddressReqPop();
	});
	
	$('form[name="frmStep3"] input[name=recv_cust_nm], input[name=recv_tel], input[name="recv_tel2"], input[name=post_no], input[name="recv_addr1"], input[name="recv_addr2"], input[name="prvtinf_arge_y"]').bind('keyup input, click', function(){
		var thisName = $(this).get(0).name;
		if('recv_cust_nm' == thisName){
			if($('.step3Info_bx').children().eq(0).hasClass('error')){
				$('form[name="frmStep3"] input[name="recv_cust_nm"]').val('');
				$('.step3Info_bx').children().eq(0).removeClass('error');
			}
		}else if('recv_tel' == thisName){
			if($('.step3Info_bx').children().eq(1).hasClass('error')){
				$('form[name="frmStep3"] input[name="recv_tel"]').val('');
				$('.step3Info_bx').children().eq(1).removeClass('error');
			}
			$(this).val($(this).val().replace(/[^0-9]/gi, ''));
		}else if('recv_tel2' == thisName){
			$(this).val($(this).val().replace(/[^0-9]/gi, ''));
		}else if('post_no' == thisName){
			if($('.step3Info_bx').children().eq(3).hasClass('error')){
				$('form[name="frmStep3"] input[name="post_no"]').val('');
				$('.step3Info_bx').children().eq(3).removeClass('error');
			}
		}else if('recv_addr1' == thisName){
			if($('.step3Info_bx').children().eq(4).hasClass('error')){
				$('form[name="frmStep3"] input[name="recv_addr1"]').val('');
				$('.step3Info_bx').children().eq(4).removeClass('error');
			}
		}else if('recv_addr2' == thisName){
			if($('.step3Info_bx').children().eq(5).hasClass('error')){
				$('form[name="frmStep3"] input[name="recv_addr2"]').val('');
				$('.step3Info_bx').children().eq(5).removeClass('error');
			}
		}else if('prvtinf_arge_y' == thisName){
			$('.err_msg').hide();
		}
	});
	
	setVisiblity('step3ReqPop', true);
}

//기본 배송지
function step3SetAddress1(){
	$('form[name="frmStep3"] input[name="recv_cust_nm"]').val('유원석');
	$('form[name="frmStep3"] input[name="recv_tel"]').val('01089643587');
	$('form[name="frmStep3"] input[name="post_no"]').val('05352');
	$('form[name="frmStep3"] input[name="recv_addr1"]').val('서울 강동구 양재대로112길');
	$('form[name="frmStep3"] input[name="recv_addr2"]').val('42, 201호 (길동)');
}

// 새로운 배송지
function step3SetAddress2(){
	$('form[name="frmStep3"] input[name="recv_cust_nm"]').val('');
	$('form[name="frmStep3"] input[name="recv_tel"]').val('');
	$('form[name="frmStep3"] input[name="post_no"]').val('');
	$('form[name="frmStep3"] input[name="recv_addr1"]').val('');
	$('form[name="frmStep3"] input[name="recv_addr2"]').val('');
}

//수정 시 값 셋팅
function step3SetModValues(){
	if(rtnChkUpd){
		$('form[name="frmStep3"] input[name="recv_cust_nm"]').val($('form[name="frmEventNoti'+idx+'"] input[name="recv_cust_nm"]').val());	// 수령 고객 명
		$('form[name="frmStep3"] input[name="recv_tel"]').val($('form[name="frmEventNoti'+idx+'"] input[name="recv_tel"]').val());			// 수령 전화
		$('form[name="frmStep3"] input[name="recv_tel2"]').val($('form[name="frmEventNoti'+idx+'"] input[name="recv_tel2"]').val());		// 수령 전화2
		$('form[name="frmStep3"] input[name="post_no"]').val($('form[name="frmEventNoti'+idx+'"] input[name="post_no"]').val());			// 우편 번호
		$('form[name="frmStep3"] input[name="recv_addr1"]').val($('form[name="frmEventNoti'+idx+'"] input[name="recv_addr1"]').val());		// 수령 주소1
		$('form[name="frmStep3"] input[name="recv_addr2"]').val($('form[name="frmEventNoti'+idx+'"] input[name="recv_addr2"]').val());		// 수령 주소2
		$('form[name="frmStep3"] textarea[name="deli_bigo"]').val($('form[name="frmEventNoti'+idx+'"] input[name="deli_bigo"]').val());		// 배송 비고
	}
}

// 유효성 체크
function step3ChkVaildEvent(){
	var recv_cust_nm = $('form[name="frmStep3"] input[name="recv_cust_nm"]').val();
	var recv_tel = $('form[name="frmStep3"] input[name="recv_tel"]').val();
	var post_no = $('form[name="frmStep3"] input[name="post_no"]').val();
	var recv_addr1 = $('form[name="frmStep3"] input[name="recv_addr1"]').val();
	var recv_addr2 = $('form[name="frmStep3"] input[name="recv_addr2"]').val();
	
	if(recv_cust_nm == '' || $('.step3Info_bx').children().eq(0).hasClass('error')){
		$('form[name="frmStep3"] input[name="recv_cust_nm"]').val('받으실분을 입력해 주세요.');
		$('.step3Info_bx').children().eq(0).addClass('error');
		return false;
	} else if(recv_tel == '' || $('.step3Info_bx').children().eq(1).hasClass('error')){
		//$('input[name="recv_tel"]').val('휴대전화번호를 입력해 주세요.');
		fn_messagePop('<p>휴대전화번호를 입력해 주세요.</p>');
		$('.step3Info_bx').children().eq(1).addClass('error');
		return false;
	} else if(!isValidPhone(recv_tel) || $('.step3Info_bx').children().eq(1).hasClass('error')){
		fn_messagePop('<p>유효하지 않은 휴대폰 번호입니다.</p>');
		$('.step3Info_bx').children().eq(1).addClass('error');
		return false;
	}else if(post_no == '' || $('.step3Info_bx').children().eq(3).hasClass('error')){
		fn_messagePop('<p>우편번호를 입력해 주세요.</p>');
		$('.step3Info_bx').children().eq(3).addClass('error');
		return false;
	}else if(post_no.length < 5){
		fn_messagePop('<p>우편번호는 5자리나 6자리를 입력해 주세요.</p>');
		$('.step3Info_bx').children().eq(3).addClass('error');
		return false;
	}else if(recv_addr1 == '' || $('.step3Info_bx').children().eq(4).hasClass('error')){
		$('form[name="frmStep3"] input[name="recv_addr1"]').val('주소를 입력해 주세요.');
		$('.step3Info_bx').children().eq(4).addClass('error');
		return false;
	}else if(recv_addr2 == '' || $('.step3Info_bx').children().eq(5).hasClass('error')){
		$('form[name="frmStep3"] input[name="recv_addr2"]').val('상세주소를 입력해 주세요.');
		$('.step3Info_bx').children().eq(5).addClass('error');
		return false;
	} else if(!$('form[name="frmStep3"] input:checkbox[name="prvtinf_arge_y"]').is(':checked')){
		fn_messagePop('<p>개인정보 수집 및 이용 동의 거부 시 서비스 이용에 제한을 받을 수 있습니다.</p>');
		return false;
	} else if($('form[name="frmStep3"] input:checkbox[name="prvtinf_arge_n"]').is(':checked')){
		$('.err_msg').show();
		return false;
	}
	
	return true;
}

function fnMaxLengthPost() {
	var postcode = $('#postcode').val();	
	postcode = postcode.replace(/[^0-9]/gi, '');
	$('#postcode').val(postcode);
	
	if ($('#postcode').val().length > 6){
		$('#postcode').val($('#postcode').val().slice(0, 6));
	}
}

function step3Back() {
	setVisiblity('step3ReqPop', false);
}

function step3Confirm() {
	if(!step3ChkVaildEvent()) return false;	// 유효성 체크

	rtnReqVal = true;											// 구분값
	rtn_recv_cust_nm = $('form[name="frmStep3"] input[name="recv_cust_nm"]').val();	// 수령 고객 명
	rtn_recv_tel = $('form[name="frmStep3"] input[name="recv_tel"]').val();			// 수령 전화
	rtn_recv_tel2 = $('form[name="frmStep3"] input[name="recv_tel2"]').val();		// 수령 전화2
	rtn_post_no = $('form[name="frmStep3"] input[name="post_no"]').val();			// 우편 번호
	rtn_recv_addr1 = $('form[name="frmStep3"] input[name="recv_addr1"]').val();		// 수령 주소1
	rtn_recv_addr2 = $('form[name="frmStep3"] input[name="recv_addr2"]').val();		// 수령 주소2
	
	var prvtinf_arge_yn = '';
	if($('form[name="frmStep3"] input:checkbox[name="prvtinf_arge_y"]').is(':checked')){
		prvtinf_arge_yn = 'Y';
	}else{
		prvtinf_arge_yn = 'N';
	}
	rtn_prvtinf_arge_yn = prvtinf_arge_yn; 					// 개인정보 동의 여부
	rtn_deli_bigo = $('form[name="frmStep3"] textarea[name="deli_bigo"]').val();	// 배송 비고

	/*기타정보 입력 체크*/
	if('Y' == $('form[name="frmEventDetail"] input[name="ETC_INFO_YN"]').val()){
		var bene_cd = '';
		var bene_creat_seq = '';
		var req_no = '';
						
		// 신청
		if(!rtnChkUpd){	
			bene_cd = $('form[name="frmEventDetail"] input[name="bene_cd"]').val();
			bene_creat_seq = $('form[name="frmEventDetail"] input[name="bene_creat_seq"]').val();
		// 수정
		} else {
			bene_cd = $('form[name="frmEventNoti'+idx+'"] input[name="bene_cd"]').val();
			bene_creat_seq = $('form[name="frmEventNoti'+idx+'"] input[name="bene_creat_seq"]').val();
			req_no = $('form[name="frmEventNoti'+idx+'"] input[name="req_no"]').val();
		}
		
		/*인원정보도 수정했을때 req_no를 초기화해서 보내줌(기존에 입력했던 기타정보 안씀)*/
		if(rtnChkUpd == true && rtn_old_pasg_id != rtn_cur_pasg_id) {
			req_no = '';
		}
		
		var $layer_popup1 = $('<div class="layer_popup1"><div class="layer_bx1"></div></div>');	// 전체 화면 팝업
		var styles1 = {width : '100%', height : '100%'};										// iframe 사이즈 정의
		var $layer_close = $('<a href="#" class=btn_close title="닫기"></a>');
		$('body').append($layer_popup1);
		$layer_popup1.append($layer_close);
		$('.layer_popup1').css(styles1);
		
		// 기타정보 입력 화면
		$('.layer_popup1').bPopup({
			contentContainer : '.layer_bx1',
			content : 'iframe',
			modalColor : '#fff',
			opacity : 1,
			loadUrl : 'http://vipm.shinsegae.com/vipmobile/event/eventPersonalInfoPop.do' +
					'?bene_cd='+bene_cd +						// 혜택 코드
					'&bene_creat_seq='+bene_creat_seq +			// 혜택 생성 순번
					'&idx='+idx +								// 인덱스 번호
					'&togatman_psn_cnt='+rtn_togatman_psn_cnt +	// 동반자 인원
					'&chkUpd='+rtnChkUpd+						// 신청, 수정구분
					'&req_no='+req_no+							// 신청번호
					'&old_pasg_id='+rtn_old_pasg_id+			// 기존 인원정보
					'&cur_pasg_id='+rtn_cur_pasg_id,			// 변경 인원정보
			closeClass : 'btn_close',
			onClose: function(){
				$('body').unbind('touchmove');	// touch event제거
				
				if(rtnReqVal){
					if(!rtnChkUpd) {
						insEvent();
					} else {
						updEvent(idx);
					}
				}
			}
		});
	}else{
		/*신청/수정*/
		if(!rtnChkUpd) {
			insEvent();
		} else {
			updEvent(idx);
		}
	}	
}

function fnAgreeYN(agree) {
	if(agree == 'Y'){
		$('#termsPrivacy').prop("checked", true);
		$('#notermsPrivacy').prop("checked", false);
	} else {
		$('#termsPrivacy').prop("checked", false);
		$('#notermsPrivacy').prop("checked", true);
		$('.err_msg').show();
	}	
}

function stepAddressReqPop() {
	setVisiblity('stepAddressReqPop', true);
		
	// tab_bx li 클릭 시 "selected"클래스 추가
	$('.tab_bx li').click(function(){
		$(this).addClass('selected').siblings().removeClass('selected');
	});

	// header높이 값 및 container 패딩값
	headHeight = $('.post_code_hd').outerHeight();
	$('.post_code_hd').css('height',headHeight);
	$('.post_code_ctnr').css('padding-top',headHeight);
	
	// 시도, 시군구 선택 시 클래스 변경
	$('.select_bx select').change(function () {
		if('' == $(this).val()) $(this).addClass('empty');
		else $(this).removeClass('empty');
	});
	$('.select_bx select').change();
	
	// 시도 선택
	$('select[name="sido_nm"]').change(function(){
		$('select[name="sigungu_nm"]').empty();
		$('select[name="sigungu_nm"]').append('<option value="">시/군/구</option>');
		if('' != $(this).val()) stepAddressGetSigungu($(this).val());
    });
	
	$('form[name="frmEventAddressPostPop"] input[name="inAddress"]').keydown(function(e){
        if(e.keyCode == 13){
            return false;
        }
    });
	
	stepAddressGetSido();
}

// type 1 : 지번, 2 : 도로명
function stepAddressSwitch(type) {
	if (type == '1') {
		if ($('#addrG').hasClass('selected') == false) {
			$('#addrG').addClass('selected');
			$('#addrR').removeClass('selected');
		}
	} else {
		if ($('#addrR').hasClass('selected') == false) {
			$('#addrG').addClass('selected');
			$('#addrG').removeClass('selected');
		}
	}
}

function stepAddressGetSido() {
	var param = {};
							
	$.ajax({
		type: 'POST',
   		url: 'http://vipm.shinsegae.com/vipmobile/event/getSidoList.do',
   		data: param,
  	  	dataType: 'json',
  	  	async : true,	// true:비동기, false:동기
  	  	cache : false,
	  	timeout : 30000,
  	  	success : function(data) {
  	  		var sidoList = data.sidoList;
  	  		
  	  		if (sidoList.length > 0) {
  	  			$('#sido_nm option').remove();
  	  			
  	  			var rowHtml = '<option value="">시/도</option>';
	  	  		$.each(sidoList, function(index, item) {
	  	  			rowHtml += '<option value="' + item.CD_NM + '">' + item.CD_NM + '</option>';
				});
	  	  		
	  	  		$('#sido_nm').append(rowHtml);
	  		}
		}
	});
}

//시/군/구 조회
function stepAddressGetSigungu(sido_nm){
	var param = {};
	param.sido_nm = sido_nm;
	$.ajax({
		type: 'POST',
   		url: 'http://vipm.shinsegae.com/vipmobile/common/getSigungu.do',
   		data: param,
  	  	dataType: 'json',
  	  	async : true,	// true:비동기, false:동기
  	  	cache : false,
	  	timeout : 30000,
  	  	success : function(data) {
  	  		var arrList = data.list;
			$.each(arrList, function(index, item) {
				var sigungu_nm = fn_chkNull(item.SIGUNGU_NM);
				$('select[name="sigungu_nm"]').append('<option value="'+sigungu_nm+'">'+sigungu_nm+'</option>');
			});
		}
	});
}

function stepAddressAddrDetail() {
	if ($('#addrG').hasClass('selected') == true) {
		stepAddressGibunAddr();
	} else {
		stepAddressDoroAddr();
	}
}

//도로명주소 조회
function stepAddressDoroAddr(sido_nm){
	if(!stepAddressChkVaildEvent()) return false;	// 유효성 체크

	var param = $('form[name="frmEventAddressPostPop"]').serialize();
	$.ajax({
		type: 'POST',
   		url: 'http://vipm.shinsegae.com/vipmobile/common/getDoroAddr.do',
   		data: param,
  	  	dataType: 'json',
  	  	async : true,	// true:비동기, false:동기
  	  	cache : false,
	  	timeout : 30000,
  	  	success : function(data) {
  	  		var arrList = data.list;
  	  		
  	  		$('.lst_none').hide();
  	  		$('.search_none').hide();
  	  		$('.code li').remove();
  	  		$('.code').show();
  	  		
			$.each(arrList, function(index, item) {
				var juso = fn_chkNull(item.JUSO);
				var post_no = fn_chkNull(item.POST_NO);
				$('.code').append('<li><input type="radio" id="postcode'+index+1+'" name="postcode" onclick="javascript:stepAddressSetValues(\''+juso+'\', \''+post_no+'\');"><label for="postcode'+index+1+'">'+juso+'</label></li>');
			});
			
			if(arrList.length == 0){
				$('.search_none').show();
				$('.search_none').html('<p><em>"'+$('input[name="inAddress"]').val()+'"</em>에 대한 검색 결과가 없습니다.<br>다시 검색해 주세요.</p>');
				return false;
			}
		}
	});
}

//지번주소 조회
function stepAddressGibunAddr(sido_nm){
	if(!stepAddressChkVaildEvent()) return false;	// 유효성 체크

	var param = $('form[name="frmEventAddressPostPop"]').serialize();
	$.ajax({
		type: 'POST',
   		url: 'http://vipm.shinsegae.com/vipmobile/common/getJibunAddr.do',
   		data: param,
  	  	dataType: 'json',
  	  	async : true,	// true:비동기, false:동기
  	  	cache : false,
	  	timeout : 30000,
  	  	success : function(data) {
  	  		var arrList = data.list;
  	  		
  	  		$('.lst_none').hide();
  	  		$('.search_none').hide();
  	  		$('.code li').remove();
  	  		$('.code').show();
  	  		
			$.each(arrList, function(index, item) {
				var juso = fn_chkNull(item.JUSO);
				var post_no = fn_chkNull(item.POST_NO);
				$('.code').append('<li><input type="radio" id="postcode'+index+1+'" name="postcode" onclick="javascript:stepAddressSetValues(\''+juso+'\', \''+post_no+'\');"><label for="postcode'+index+1+'">'+juso+'</label></li>');
			});
			
			if(arrList.length == 0){
				$('.search_none').show();
				$('.search_none').html('<p><em>"'+$('input[name="inAddress"]').val()+'"</em>에 대한 검색 결과가 없습니다.<br>다시 검색해 주세요.</p>');
				return false;
			}
		}
	});
}

//유효성 체크
function stepAddressChkVaildEvent(){
	if($('select[name="sido_nm"]').val() == ''){
		fn_messagePop('<p>시/도를 선택해 주세요.</p>');
		return false;
	} else if($('select[name="sido_nm"]').val() != '세종특별자치시' && $('select[name="sigungu_nm"]').val() == ''){
		fn_messagePop('<p>시/군/구를 선택해 주세요.</p>');
		return false;
	} else if($('input[name="inAddress"]').val() == ''){
		fn_messagePop('<p>주소를 입력해 주세요.</p>');
		return false;
	} else if($('input[name="inAddress"]').val().length < 2){
		fn_messagePop('<p>주소를 2자 이상 입력해 주세요.</p>');
		return false;
	}
	
	return true;
}

function stepAddressSetValues(juso, post_no){
	$('input[name="recv_addr1"]').val(juso);
	$('input[name="post_no"]').val(post_no);
	$('#stepAddressReqPop').hide();
}
</script>
</head>
<body>
<div id="wrap" class="vip">
	<div id="header">
		<h1 class="blind">VIP 이벤트 상세페이지</h1>
	</div>
	<div id="container">
		<div class="top_bx">
			<img id="test_img" src="http://vipm.shinsegae.com/img/beneFile/20170927184024746561.jpg" alt="[10월] 프라이빗이벤트 세일리지 전환 이벤트 (3회차)">
	 		<!-- <img src="http://vipm.shinsegae.com/vipmobile/resources/img/temp/temp4.jpg"> -->
			<div class="dim"></div>
		</div>
		<div class="contents">
			<div class="info">
				<div class="info_bx">
					<div class="heart " id="heart" onclick="heartToggle();">Heart</div>
					<p class="tag">
						<span>프라이빗 이벤트</span>
						<span class="sub">기타</span>
					</p>
					<!-- 모든 혜택에서 나타냄 -->
					<h2 class="ttl">[10월] 프라이빗이벤트 세일리지 전환 이벤트 (3회차)</h2>
					<!-- 프라이빗이벤트 인 경우 평가를 나타냄 -->
					<div class="star_score">
						<span class="st_off"><span class="st_on" style="width:0%">평점 - 총 5점 중</span></span>
						<span class="score">(0명 참여)</span>
					</div>
					<!-- 모든 혜택에서 나타냄 -->
					<p class="date">2017.10.16 (월) ~ 2017.10.22 (일)</p>
					<!-- 기프트가 아닌 경우 신청회수 및 포인트를 나타냄 -->
					<!-- 
					<script type="text/javascript">
					 var max_use_cnt_pt = '120MIL P';
					 max_use_cnt_pt = max_use_cnt_pt.replace(/MIL/gi, '만').replace(/YEAR/gi, '연').replace(/CNT/gi, '회').replace(/P/gi, '포인트').replace(/NO/gi, '');
					 $('.point').append(max_use_cnt_pt);
					</script>
					 -->
					<p class="point"></p>
					<script type="text/javascript">
					/*
					var max_use_cnt_pt = '총 ';
					var total = 1200000;
					if (total >= 10000) {
					 total = total / 10000;
					 total += "만";
					}
					var total = 1200000;
					if (total >= 10000) {
					 total = total / 10000;
					 total += "만";
					}
						txt_remain_cnt_pt = '남은 포인트 : '+restPoint+' 포인트';
					max_use_cnt_pt += 120MIL P;
					max_use_cnt_pt += ' 포인트 중';
					max_use_cnt_pt += 1200000;
					max_use_cnt_pt += ' 포인트 사용 가능합니다.';
					*/
					var type = 2;
					if( type == "1" ){
					 var max_use_cnt_pt = '총 신청가능횟수 120MIL P 중 1200000회 신청 가능합니다.';
					 max_use_cnt_pt = max_use_cnt_pt.replace(/MIL/gi, '만').replace(/YEAR/gi, '연').replace(/CNT/gi, '회').replace(/P/gi, '포인트').replace(/NO/gi, ''); 
					}else{
					 var total = 1200000;
					 if (total > 10000) {
						 total = parseInt((total / 10000)) + '만';
					 }
					 var remain_point = 1200000;
					 if (remain_point > 10000) {
						 remain_point = parseInt((remain_point / 10000)) + '만';
					 }
					 
					 //총 120만 포인트 중 20만 포인트 사용 가능합니다.
					 var max_use_cnt_pt =  '총 '+total+' 포인트 중 '+remain_point+' 포인트 사용 가능합니다.';
					 
					}
					$('.point').append(max_use_cnt_pt);
					</script>
					<!-- 아트&컬처, 신청 제한 구분 코드가 응모수제한(002) 인 경우 좌석 정보 조회 나타냄 -->
				</div>
			</div>
			<div class="detail">
				<!-- 항목 타이틀 + 텍스트(TEMP_SEQ eq '1') -->
				<!-- 타이틀 텍스트 + 단순 텍스트(TEMP_SEQ eq '2') -->
				<!-- 타이틀 텍스트 + 서브 타이틀 + 단순 텍스트(TEMP_SEQ eq '3') -->
				<!-- 서브 타이틀 + 텍스트 항목(TEMP_SEQ eq '4') -->
				<!-- 이미지(TEMP_SEQ eq '5') -->
				<div class="md imgarea">
					<img src="http://vipm.shinsegae.com/img/beneFile/20170927184045226014.jpg" alt="[10월] 프라이빗이벤트 세일리지 전환 이벤트 (3회차)">
				</div>
			</div>
		</div>
		<a href="javascript:void(0)" class="next_cont" title="NEXT CONTENTS로 이동">NEXT CONTENTS</a>
	</div>
	<div id="bottom">						
		<!-- 프라이빗 이벤트 인 경우 중복 신청 가능 -->
		<!-- 프라이빗이벤트 -->
		<button id="btm_apply" class="btn btm_r on" onclick="javascript:reqEventPopNew(false);"><span>신청</span></button>
		<button id="btm_back" class="btn btm_back" onclick="fnGoList();"><span>뒤로가기</span></button>
		<button id="btm_home" class="btn btm_home" onclick="fnGoHome();"><span>홈</span></button>
		<!-- 
		[D] 우측에 위치하는 신청/확인 버튼은
		필수 입력값 입력 여부/신청 가능 여부에 따라 on클래스가 붙는다
		-->
	</div>
	<div id="dim" style="overflow:hidden;position:absolute;left:0;top:0;z-index:10;width:100%;height:100%;background:#000;opacity:.70;display:none;">
	</div>	
</div>
<!-- form -->
<form name="frmEventDetail">
	<input type="hidden" name="ITMGRP" id="ITMGRP" value="" />
	<input type="hidden" name="EVT_ROOT" id="EVT_ROOT" value="SPECIALS" />
	<input type="hidden" name="THESPECIAL_CATG_CD" id="THESPECIAL_CATG_CD" value="70" />
	<input type="hidden" name="upper_catg_cd" id="upper_catg_cd" value="2" />
	<input type="hidden" name="bene_cd" id="bene_cd" value="E000000017" />							<!-- 혜택 코드 -->
	<input type="hidden" name="bene_creat_seq" id="bene_creat_seq" value="11240" />			<!-- 혜택 생성 순번 -->	
	<input type="hidden" name="upper_catg_cd" id="upper_catg_cd" value="2" />				<!-- 상위 혜택 분류 코드 -->
	<input type="hidden" name="upper_catg_nm" id="upper_catg_nm" value="프라이빗 이벤트" />				<!-- 상위 혜택 분류 명 -->
	<input type="hidden" name="bene_catg_cd" id="bene_catg_cd" value="20" />				<!-- 혜택 분류 코드 -->
	<input type="hidden" name="bene_catg_nm" id="bene_catg_nm" value="기타" />				<!-- 혜택 분류 명 -->
	<input type="hidden" name="event_nm" id="event_nm" value="[10월] 프라이빗이벤트 세일리지 전환 이벤트 (3회차)" />						<!-- 행사명 -->
	<input type="hidden" name="exec_dt" id="exec_dt" value="2017.10.16 (월) ~ 2017.10.22 (일)" />							<!-- 실행 일자 -->
	<input type="hidden" name="use_gubun_cd" id="use_gubun_cd" value="2" />				<!-- 이용 구분 코드 -->
	<input type="hidden" name="max_use_cnt_pt" id="max_use_cnt_pt" value="120MIL P" />			<!-- 최대 이용 횟수, 포인트 -->
	<input type="hidden" name="bcd_job_gubun_cd" id="bcd_job_gubun_cd" value="02" />		<!-- 바코드 업무 구분 코드 -->
	<input type="hidden" name="bene_gubun_cd" id="bene_gubun_cd" value="04" />				<!-- 혜택 구분 코드 -->
	<input type="hidden" name="req_limit_gubun_cd" id="req_limit_gubun_cd" value="001" />	<!-- 신청 제한 구분 코드 -->
	<input type="hidden" name="remain_cnt_pt" id="remain_cnt_pt" value="1200000" />				<!-- 남은 이용 횟수, 포인트 -->
	<input type="hidden" name="exec_strt_dt" id="exec_strt_dt" value="20171016" />				<!-- 실행 시작 일자 -->
	<input type="hidden" name="exec_strt_tm" id="exec_strt_tm" value="1000" />				<!-- 실행 시작 시간 -->
	<input type="hidden" name="exec_end_dt" id="exec_end_dt" value="20171022" />				<!-- 실행 시작 시간 -->
	<input type="hidden" name="togatman_psn_cnt" id="togatman_psn_cnt" value="" />		<!-- 동반자 인원 -->
	<input type="hidden" name="recv_strt_dt" value="201710161000" />				<!-- 접수 시작 일시 -->
	<input type="hidden" name="recv_end_dt" value="201710222359" />					<!-- 접수 종료 일시 -->
	<input type="hidden" name="cust_eval_per" value="0" />				<!-- 평가율 -->
	<input type="hidden" name="cust_eval_num" value="0" />				<!-- 평가자 수 -->
	<input type="hidden" name="req_cnt" value="0" />								<!-- 이벤트 등록 여부 -->
	<input type="hidden" name="rest_prvt_pt" value="1200000" />				<!-- 남은 프라이빗 포인트 -->
	<input type="hidden" name="req_no" />																				<!-- 신청 번호 -->
	<input type="hidden" name="itm_grp_seq" />																			<!-- 품목 그룹 순번 -->
	<input type="hidden" name="itm_seq" />																				<!-- 품목 순번 -->
	<input type="hidden" name="hope_seq" />																				<!-- 희망 순번 -->
	<input type="hidden" name="pt_duct_except_yn" />				
	<input type="hidden" name="duct_prvt_pt" />	<!-- 차감 프라이빗 포인트 -->
	<input type="hidden" name="rest_prvt_pt" />																			<!-- 차감 프라이빗 포인트(잔여 포인트 계산용) -->
	<input type="hidden" name="use_prvt_pt" />																			<!-- 차감 프라이빗 포인트(이력 포인트 계산용) -->
	<input type="hidden" name="now_req_cnt" />																			<!-- 현재 신청 수 -->
	<input type="hidden" name="now_togat_ics_req_psn_cnt" />															<!-- 현재 동반 포함 신청 인원 -->
	<input type="hidden" name="rsrv_togat_psn_cnt" />																	<!-- 예약 동반 인원 -->
	<input type="hidden" name="rsrv_dt" />																				<!-- 예약일자 -->
	<input type="hidden" name="rsrv_tm" />																				<!-- 예약시간 -->
	<input type="hidden" name="hope_recv_recv_dt" />																	<!-- 희망 수령 접수 일자 -->
	<input type="hidden" name="recv_cust_nm" />																			<!-- 수령 고객 명 -->
	<input type="hidden" name="recv_tel" />																				<!-- 수령 전화 -->
	<input type="hidden" name="recv_tel2" />																			<!-- 수령 전화2 -->
	<input type="hidden" name="post_no" />																				<!-- 우편 번호 -->
	<input type="hidden" name="recv_addr1" />																			<!-- 수령 주소1 -->
	<input type="hidden" name="recv_addr2" />																			<!-- 수령 주소2 -->
	<input type="hidden" name="prvtinf_arge_yn" />																		<!-- 개인정보 동의 여부 -->
	<input type="hidden" name="deli_bigo" />																			<!-- 배송 비고 -->
	<input type="hidden" name="chkUpd" />																				<!-- 신청, 수정 구분 값 -->
	<input type="hidden" name="etcInfo" />																				<!-- 기타 정보 -->
	<input type="hidden" name="ATTACHMENT_PATH" value="/img/beneFile/"/>								<!-- 이미지 경로 -->
	<input type="hidden" name="IMG_PATH_IP" value="http://vipm.shinsegae.com" />					<!-- 이미지 IP -->
	<input type="hidden" name="LIST_ATTACHMENT_NM" value="20170927184019367234.jpg" />	<!-- 목록 이미지명 -->
	<input type="hidden" name="ATTACHMENT_NM" value="20170927184024746561.jpg" />				<!-- 이미지명 -->
	<input type="hidden" name="DEL_RSRV_DT" value="20171023" />					<!-- 삭제일 -->
	<input type="hidden" name="ETC_INFO_YN" value="N" />					<!-- 기타정보 여부 -->
	<input type="hidden" name="recv_store_cd" />																		<!-- 수령지점 -->
	<input type="hidden" name="THESPECIAL_CREAT_SEQ" />
	<input type="hidden" name="N_BENE_CD" id="N_BENE_CD" value="S000000001"/>								<!-- 다음 혜택 코드 -->
	<input type="hidden" name="N_BENE_CREAT_SEQ" id="N_BENE_CREAT_SEQ" value="665"/>			<!-- 다음 혜택 생성 순번 -->
	<input type="hidden" name="N_SPEICAL_YN" id="N_SPEICAL_YN" value="Y"/>						<!-- 다음 혜택 스페셜즈 유무 -->
	<input type="hidden" name="N_UPPER_CATG_CD" id="N_UPPER_CATG_CD" value="0"/>
</form>

<div class="layer_popup_new" id="step1ReqPop" style="width:100%;height:100%;display:none;">
	<div class="layer_bx_new" id="step1ReqPop_bx" style="position:fixed;z-index:99;" onclick="hideStep1();">
		<div id="ly_wrap" class="bt_ly">
			<!-- form -->
			<form name="frmStep1ReqPop">
				<input type="hidden" name="bene_cd" id="bene_cd"/>							<!-- 혜택 코드 -->
				<input type="hidden" name="bene_creat_seq" id="bene_creat_seq"/>			<!-- 혜택 생성 순번 -->
				<input type="hidden" name="itm_grp_seq" id="itm_grp_seq"/>					<!-- 품목 그룹 순번 -->
				<input type="hidden" name="itm_seq" id="itm_seq"/>							<!-- 품목 순번 -->
				<input type="hidden" name="deli_catg_cd" id="deli_catg_cd"/>				<!-- 배송 분류 코드 -->
				<input type="hidden" name="duct_prvt_pt" id="duct_prvt_pt"/>				<!-- 차감 프라이빗 포인트 -->
				<input type="hidden" name="deli_catg_cd_valid" id="deli_catg_cd_valid"/>	<!-- 배송 분류 코드 구분(품목그룹안의 품목들의 배송분류코드가 모두 같으면 true 하나라도 다르면 false) -->
				<input type="hidden" name="rsrv_togat_psn_cnt" id="rsrv_togat_psn_cnt"/>		<!-- 동반인원 -->
			</form>
			<div id="ly_hd">
				<h1 class="blind">옵션 선택 팝업</h1>
			</div>
			<div id="ly_ctnr">
				<div class="op_bx">
					<p class="msg"><span id="txt_remain_cnt_pt"></span></p>
					<div class="cdt_bx">
						<div class="cdt">
							<!-- [D] : op_lst에서 선택된 내용이 op_lb 값으로 들어옴 -->
							<a href="javascript:void(0)" id="selItemGroup" class="op_lb">선택</a>
							<div id="divItemGroup" class="op_lst">
								<ul>

									<li>
										<input type="radio" name="raItemGroup" value="103374">
										<label>
											프라이빗포인트 (120만점)-120만
											
										</label>
									</li>
								
									<li>
										<input type="radio" name="raItemGroup" value="103375">
										<label>
											프라이빗포인트 (110만점)-11만
											
										</label>
									</li>
								
									<li>
										<input type="radio" name="raItemGroup" value="103376">
										<label>
											프라이빗포인트 (100만점)-100만
											
										</label>
									</li>
								
									<li>
										<input type="radio" name="raItemGroup" value="103377">
										<label>
											프라이빗포인트 (90만점)-90만
											
										</label>
									</li>
								
									<li>
										<input type="radio" name="raItemGroup" value="103378">
										<label>
											프라이빗포인트 (80만점)-80만
											
										</label>
									</li>
								
									<li>
										<input type="radio" name="raItemGroup" value="103379">
										<label>
											프라이빗포인트 (70만점)-70만
											
										</label>
									</li>
								
									<li>
										<input type="radio" name="raItemGroup" value="103380">
										<label>
											프라이빗포인트 (60만점)-60만
											
										</label>
									</li>
								
									<li>
										<input type="radio" name="raItemGroup" value="103381">
										<label>
											프라이빗포인트 (50만점)-50만
											
										</label>
									</li>
								
									<li>
										<input type="radio" name="raItemGroup" value="103383">
										<label>
											프라이빗포인트 (40만점)-40만
											
										</label>
									</li>
								
									<li>
										<input type="radio" name="raItemGroup" value="103385">
										<label>
											프라이빗포인트 (30만점)-30만
											
										</label>
									</li>
								
									<li>
										<input type="radio" name="raItemGroup" value="103387">
										<label>
											프라이빗포인트 (20만점)-20만
											
										</label>
									</li>
								
									<li>
										<input type="radio" name="raItemGroup" value="103390">
										<label>
											프라이빗포인트 (10만점)-10만
											
										</label>
									</li>
								
								</ul>
							</div>
						</div>
						
						<div class="cdt">
							<!-- [D] : op_lst에서 선택된 내용이 op_lb 값으로 들어옴 -->
							<a href="javascript:void(0)" id="selPassenger" class="op_lb" title="인원 선택">인원 선택</a>
							<div id="divPassenger" class="op_lst">
								<ul>
								</ul>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="btn_bx">
				<button id="req_cancel" class="btn cancel"><span>취소</span></button>
				<span class="line"></span>
				<button id="req_confirm" class="btn confirm"><span>확인</span></button>
			</div>
		</div>
	</div>
</div>

<div class="layer_popup_new" id="step2ReqPop" style="width:100%;height:100%;display:none;">
	<div class="layer_bx_new" style="position:fixed;z-index:99;">
		<div id="wrap" class="delivery_pick sorting_pop">
			<div id="header">
				<h1 id="step2title">예약<br>날짜</h1>
				<p id="step2subtitle" class="guide_txt">예약 날짜를 선택해주세요.</p>
			</div>
			<div id="container">
				<div class="info_bx" id="hopeDt_info">
				</div>
				<!-- 
				<div class="input_bx">
					[D] 필수영역 미 입력시 인풋박스에 error 클래스 추가
					<input type="date" name="deliveryDate" placeholder="날짜 입력"><label for="deliveryDate" class="blind">택배를 수령하실 날짜를 입력해주세요.</label>
				</div>
				 -->
			</div>
			<div id="bottom">
				<button id="step2_back" class="btn btm_back" onclick="javascript:step2Back();"><span>뒤로가기</span></button>
				<button id="step2_apply" class="btn btm_r on" onclick="javascript:step2Confirm('');"><span>확인</span></button>
				<!-- 
				[D] 우측에 위치하는 신청/확인 버튼은
				필수 입력값 입력 여부/신청 가능 여부에 따라 on클래스가 붙는다
				-->
			</div>
		</div>
	</div>
</div>

<!-- 배송지 입력 팝업 -->
<div class="layer_popup_new" id="step3ReqPop" style="width:100%;height:100%;display:none;">
	<div class="layer_bx_new" style="position:fixed;z-index:99;">
		<div id="wrap" class="address sorting_pop">
			<div id="header">
				<h1>주소 입력</h1>
				<p class="guide_txt">선물을 원하실 경우, 새로운 배송지를 선택하여<br>선물 받으실 분의 정보를 기입해주세요.</p>
			</div>
			<form name="frmStep3">
			<div id="container">
				<div class="delivery_tab">
					<input type="radio" id="address1" name="address" checked="checked"><label for="address1">기본 배송지</label>
					<input type="radio" id="address2" name="address"><label for="address2">새로운 배송지</label>
				</div>
				<!-- [D] 필수입력영역 미 입력시 dl에 error 클래스 추가 -->
				<div class="info_bx step3Info_bx">
					<dl>
						<dt>받으실분</dt>
						<dd><input type="text" id="name" name="recv_cust_nm" maxlength="20"><label for="name" class="blind">받으실분을 입력해 주세요.</label></dd>
					</dl>
					<dl>
						<dt>휴대전화</dt>
						<dd><input type="number" id="cellPhone" pattern="[0-9]*" inputmode="numeric" name="recv_tel" max="99999999999" maxlength="11" oninput="fnMaxLengthChk(this);"><label for="cellPhone" class="blind">휴대전화번호를 입력해 주세요.</label></dd>
					</dl>
					<dl>
						<dt>추가번호</dt>
						<dd><input type="number" id="phone" pattern="[0-9]*" inputmode="numeric" name="recv_tel2" max="99999999999" maxlength="11" oninput="fnMaxLengthChk(this);"><label for="phone" class="blind">추가번호를 입력해 주세요.</label></dd>
					</dl>
				</div>
				<div class="info_bx step3Info_bx">
					<dl>
						<dt>우편번호</dt>
						<dd><input type="number" pattern="[0-9]*" inputmode="numeric" id="postcode" name="post_no" class="postcode" max="999999" maxlength="6" oninput="fnMaxLengthPost();"><label for="postcode" class="blind">우편번호를 입력해 주세요.</label><a href="javascript:void(0)" class="btn_postcode" title="검색">검색</a></dd>
					</dl>
					<dl>
						<dt>주소</dt>
						<dd><input type="text" id="address1" name="recv_addr1"><label for="address1" class="blind">주소를 입력해 주세요.</label></dd>
					</dl>
					<dl>
						<dt>상세주소</dt>
						<dd><input type="text" id="address2" name="recv_addr2" maxlength="50"><label for="address2" class="blind">상세주소를 입력해 주세요.</label></dd>
					</dl>
				</div>
				<div class="agr_bx">
					<div class="agree_check">
						<label for="termsPrivacy">개인정보 수집 및 이용 동의</label><a href="javascript:void(0)" class="btn_terms" title="우편번호">자세히보기</a>
					</div>
					<div class="agree_check_choice" style="margin-top:10px;">
						<input type="checkbox" id="termsPrivacy" name="prvtinf_arge_y" onclick="fnAgreeYN('Y')"><label for="termsPrivacy">동의</label>
						<input type="checkbox" id="notermsPrivacy" name="prvtinf_arge_n" onclick="fnAgreeYN('N')" style="margin-left:10px"><label for="notermsPrivacy">동의 안 함</label>
					</div>
					<!-- [D] 개인정보 수집 미 동의시 노출 -->
					<p class="err_msg" style="display:none">개인정보 수집 및 이용동의를 선택해 주세요.</p>
				</div>
				<div class="msg_bx">
					<h3>배송요청사항</h3>
					<textarea id="deliveryComment" name="deli_bigo" rows="2" cols="" maxlength="100"></textarea><label for="deliveryComment" class="blind">배송유의사항을 입력해 주세요.</label>
				</div>
			</div>
			</form>
			<div id="bottom">
				<button id="btm_back" class="btn btm_back" onclick="javascript:step3Back();"><span>뒤로가기</span></button>
				<button id="btm_apply" class="btn btm_r on" onclick="javascript:step3Confirm();"><span>확인</span></button>
				<!-- 
				[D] 우측에 위치하는 신청/확인 버튼은
				필수 입력값 입력 여부/신청 가능 여부에 따라 on클래스가 붙는다
				-->
			</div>
		</div>
	</div>
</div>

<!-- 주소 검색 팝업 -->
<div class="layer_popup_new" id="stepAddressReqPop" style="width:100%;height:100%;display:none;">
	<div class="layer_bx_new" style="position:fixed;z-index:99;">
		<div id="ly_wrap" class="post_code sorting_pop">
			<form name="frmEventAddressPostPop">
			<div id="ly_hd" class="post_code_hd">
				<a href="javascript:void(0)" title="팝업 닫기" class="btn_close">팝업 닫기</a>
				<h1>주소 검색</h1>
				<div class="tab_bx">
					<ul>
					<li class="selected" id="addrG"><a href="#" title="지번주소" onclick="stepAddressSwitch('1')">지번 주소</a></li>
					<li id="addrR"><a href="#" title="도로명 주소" onclick="stepAddressSwitch('2')">도로명 주소</a></li>
					</ul>
				</div>
				<div class="select_bx">
					<select name="sido_nm" id="sido_nm" title="시도선택">
						<option value="">시/도</option>
					</select>
					<select name="sigungu_nm" id="sigungu_nm" title="시군구선택">
						<option value="">시/군/구</option>
					</select>
				</div>
				<div class="search_bx">
					<input type="text" id="inAddress" name="inAddress" placeholder="검색"><label for="inAddress" class="blind">주소를 입력해주세요.</label><a href="javascript:stepAddressAddrDetail();" class="btn_search" title="주소검색">주소검색</a>
				</div>
			</div>
			</form>
			<div id="ly_ctnr"  class="post_code_ctnr">
				<div class="code_lst">
					<!-- [D] 검색 전 lst_none 노출 -->
					<div class="lst_none">
						<p class="lst_none_ttl">시/도 및 시/군/구 선택 후 주소명을 검색해주세요.</p>
						<ul class="ex">
						<li>동+건물명 입력: 예) 충무로 중앙우체국</li>
						<li>도로명+건물번호 입력: 예) 소공로 70</li>
						<li>건물명 입력: 예) 중앙우체국</li>
						<ul>
					</div>
					<!-- [D] 검색결과가 없을 때 search_none 노출 -->
					<div class="search_none" style="display:none">
					</div>
					<ul class="code" style="display:none">
					</ul>
				</div>
			</div>
		</div>
		<a href="#" class="btn_close1" style="z-index:100;"title="닫기" onclick="setVisiblity('stepAddressReqPop', false)"></a>
	</div>
</div>
</body>
</html>